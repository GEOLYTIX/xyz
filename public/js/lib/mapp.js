var tt=Object.defineProperty;var ot=(e,o)=>{for(var t in o)tt(e,t,{get:o[t],enumerable:!0})};var F=e=>({get:o=>e.get(o),set:(o,t)=>(e.set(o,t),t)}),q=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,nt=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,rt=/<[a-z][^>]+$/i,it=/>[^<>]*$/,st=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,lt=/\s+$/,H=(e,o)=>0<o--&&(rt.test(e[o])||!it.test(e[o])&&H(e,o)),at=(e,o,t)=>nt.test(o)?e:`<${o}${t.replace(lt,"")}></${o}>`,ct=(e,o,t)=>{let n=[],{length:i}=e;for(let a=1;a<i;a++){let l=e[a-1];n.push(q.test(l)&&H(e,a)?l.replace(q,(c,s,u)=>`${o}${a-1}=${u||'"'}${s}${u?"":'"'}`):`${l}<!--${o}${a-1}-->`)}n.push(e[i-1]);let r=n.join("").trim();return t?r:r.replace(st,at)},{isArray:T}=Array,{indexOf:ut,slice:D}=[],pt=1,W=111,dt=({firstChild:e,lastChild:o})=>{let t=document.createRange();return t.setStartAfter(e),t.setEndAfter(o),t.deleteContents(),e},ft=(e,o)=>e.nodeType===W?1/o<0?o?dt(e):e.lastChild:o?e.valueOf():e.firstChild:e,mt=e=>{let{childNodes:o}=e,{length:t}=o;if(t<2)return t?o[0]:e;let n=D.call(o,0),i=n[0],r=n[t-1];return{ELEMENT_NODE:pt,nodeType:W,firstChild:i,lastChild:r,valueOf(){if(o.length!==t){let a=0;for(;a<t;)e.appendChild(n[a++])}return e}}},ht=(e,o,t,n,i)=>{let r=t.length,a=o.length,l=r,c=0,s=0,u=null;for(;c<a||s<l;)if(a===c){let p=l<r?s?n(t[s-1],-0).nextSibling:n(t[l-s],0):i;for(;s<l;)e.insertBefore(n(t[s++],1),p)}else if(l===s)for(;c<a;)(!u||!u.has(o[c]))&&e.removeChild(n(o[c],-1)),c++;else if(o[c]===t[s])c++,s++;else if(o[a-1]===t[l-1])a--,l--;else if(o[c]===t[l-1]&&t[s]===o[a-1]){let p=n(o[--a],-1).nextSibling;e.insertBefore(n(t[s++],1),n(o[c++],-1).nextSibling),e.insertBefore(n(t[--l],1),p),o[a]=t[l]}else{if(!u){u=new Map;let p=s;for(;p<l;)u.set(t[p],p++)}if(u.has(o[c])){let p=u.get(o[c]);if(s<p&&p<l){let m=c,g=1;for(;++m<a&&m<l&&u.get(o[m])===p+g;)g++;if(g>p-s){let x=n(o[c],0);for(;s<p;)e.insertBefore(n(t[s++],1),x)}else e.replaceChild(n(t[s++],1),n(o[c++],-1))}else c++}else e.removeChild(n(o[c++],-1))}return t},gt=e=>o=>{for(let t in o){let n=t==="role"?t:`aria-${t}`,i=o[t];i==null?e.removeAttribute(n):e.setAttribute(n,i)}},wt=(e,o)=>{let t,n=!0,i=document.createAttributeNS(null,o);return r=>{if(t!==r)if(t=r,t==null)n||(e.removeAttributeNode(i),n=!0);else{let a=r;a==null?(n||e.removeAttributeNode(i),n=!0):(i.value=a,n&&(e.setAttributeNodeNS(i),n=!1))}}},yt=(e,o,t)=>n=>{t!==!!n&&((t=!!n)?e.setAttribute(o,""):e.removeAttribute(o))},xt=({dataset:e})=>o=>{for(let t in o){let n=o[t];n==null?delete e[t]:e[t]=n}},J=(e,o)=>{let t,n,i=o.slice(2);return!(o in e)&&(n=o.toLowerCase())in e&&(i=n.slice(2)),r=>{let a=T(r)?r:[r,!1];t!==a[0]&&(t&&e.removeEventListener(i,t,a[1]),(t=a[0])&&e.addEventListener(i,t,a[1]))}},bt=e=>{let o;return t=>{o!==t&&(o=t,typeof t=="function"?t(e):t.current=e)}},vt=(e,o)=>o==="dataset"?xt(e):t=>{e[o]=t},St=e=>{let o;return t=>{o!=t&&(o=t,e.textContent=t??"")}},kt=({childNodes:e},o)=>e[o],S=(e,o,t)=>ht(e.parentNode,o,t,ft,e),jt=e=>{let o,t,n=[],i=r=>{switch(typeof r){case"string":case"number":case"boolean":o!==r&&(o=r,t||(t=document.createTextNode("")),t.data=r,n=S(e,n,[t]));break;case"object":case"undefined":if(r==null){o!=r&&(o=r,n=S(e,n,[]));break}if(T(r)){o=r,r.length===0?n=S(e,n,[]):typeof r[0]=="object"?n=S(e,n,r):i(String(r));break}o!==r&&"ELEMENT_NODE"in r&&(o=r,n=S(e,n,r.nodeType===11?D.call(r.childNodes):[r]));break;case"function":i(r(e));break}};return i},Et=(e,o)=>{switch(o[0]){case"?":return yt(e,o.slice(1),!1);case".":return vt(e,o.slice(1));case"@":return J(e,"on"+o.slice(1));case"o":if(o[1]==="n")return J(e,o)}switch(o){case"ref":return bt(e);case"aria":return gt(e)}return wt(e,o)};function Ct(e){let{type:o,path:t}=e,n=t.reduceRight(kt,this);return o==="node"?jt(n):o==="attr"?Et(n,e.name):St(n)}var K=function(e){var o="fragment",t="template",n="content"in a(t),i=n?function(c){var s=a(t);return s.innerHTML=c,s.content}:function(c){var s=a(o),u=a(t),p=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(c)){var m=RegExp.$1;u.innerHTML="<table>"+c+"</table>",p=u.querySelectorAll(m)}else u.innerHTML=c,p=u.childNodes;return r(s,p),s};return function(s,u){return(u==="svg"?l:i)(s)};function r(c,s){for(var u=s.length;u--;)c.appendChild(s[0])}function a(c){return c===o?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",c)}function l(c){var s=a(o),u=a("div");return u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+c+"</svg>",r(s,u.firstChild.childNodes),s}}(document),X=document.importNode.length!=1,Mt=X?(e,o,t)=>document.importNode(K(e,o,t),!0):K,$t=X?e=>document.createTreeWalker(e,1|128,null,!1):e=>document.createTreeWalker(e,1|128),P=e=>{let o=[],{parentNode:t}=e;for(;t;)o.push(ut.call(t.childNodes,e)),e=t,t=e.parentNode;return o},k="isµ",Q=F(new WeakMap),Lt=/^(?:plaintext|script|style|textarea|title|xmp)$/i,j=()=>({stack:[],entry:null,wire:null}),Tt=(e,o)=>{let{content:t,updates:n}=Ft(e,o);return{type:e,template:o,content:t,updates:n,wire:null}},Pt=(e,o)=>{let t=ct(o,k,e==="svg"),n=Mt(t,e),i=$t(n),r=[],a=o.length-1,l=0,c=`${k}${l}`;for(;l<a;){let s=i.nextNode();if(!s)throw`bad template: ${t}`;if(s.nodeType===8)s.data===c&&(r.push({type:"node",path:P(s)}),c=`${k}${++l}`);else{for(;s.hasAttribute(c);)r.push({type:"attr",path:P(s),name:s.getAttribute(c)}),s.removeAttribute(c),c=`${k}${++l}`;Lt.test(s.tagName)&&s.textContent.trim()===`<!--${c}-->`&&(s.textContent="",r.push({type:"text",path:P(s)}),c=`${k}${++l}`)}}return{content:n,nodes:r}},Ft=(e,o)=>{let{content:t,nodes:n}=Q.get(o)||Q.set(o,Pt(e,o)),i=document.importNode(t,!0),r=n.map(Ct,i);return{content:i,updates:r}},M=(e,{type:o,template:t,values:n})=>{let{length:i}=n;Y(e,n,i);let{entry:r}=e;(!r||r.template!==t||r.type!==o)&&(e.entry=r=Tt(o,t));let{content:a,updates:l,wire:c}=r;for(let s=0;s<i;s++)l[s](n[s]);return c||(r.wire=mt(a))},Y=({stack:e},o,t)=>{for(let n=0;n<t;n++){let i=o[n];i instanceof O?o[n]=M(e[n]||(e[n]=j()),i):T(i)?Y(e[n]||(e[n]=j()),i,i.length):e[n]=null}t<e.length&&e.splice(t)};function O(e,o,t){this.type=e,this.template=o,this.values=t}var{create:Ot,defineProperties:zt}=Object,ee=e=>{let o=F(new WeakMap),t=n=>(i,...r)=>M(n,{type:e,template:i,values:r});return zt((n,...i)=>new O(e,n,i),{for:{value(n,i){let r=o.get(n)||o.set(n,Ot(null));return r[i]||(r[i]=t(j()))}},node:{value:(n,...i)=>M(j(),{type:e,template:n,values:i}).valueOf()}})},te=F(new WeakMap),oe=(e,o)=>{let t=typeof o=="function"?o():o,n=te.get(e)||te.set(e,j()),i=t instanceof O?M(n,t):t;return i!==n.wire&&(n.wire=i,e.textContent="",e.appendChild(i.valueOf())),e},ne=ee("html"),f=ee("svg");function $(e,o=new WeakMap){if(e===null||typeof e!="object"||typeof e=="function"||e instanceof HTMLElement)return e;let t=Array.isArray(e)?[]:{};if(o.get(e))return o.get(e);o.set(e,t);for(let n in e)t[n]=$(e[n],o);return t}function re(e){let o=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);o.value=e,o.select(),document.execCommand("copy"),o.remove()}function ie(e){if(e.indexOf(";base64,")==-1){let r=e.split(","),a=r[0].split(":")[1],l=r[1];return new Blob([l],{type:a})}let o=e.split(";base64,"),t=o[0].split(":")[1],n=window.atob(o[1]),i=new Uint8Array(n.length);for(let r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return new Blob([i],{type:t})}var It=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],_t=1;var h=typeof BigInt!="undefined"?BigInt:Number;function se(e){let o=At(e),t=Gt(o[0],o[1]),n=10**t.precision,i=10**t.thirdDimPrecision,{thirdDim:r}=t,a=0,l=0,c=0,s=[],u=2;for(;u<o.length;){let p=z(o[u])/n,m=z(o[u+1])/n;a+=p,l+=m,r?(c+=z(o[u+2])/i,s.push([a,l,c]),u+=3):(s.push([a,l]),u+=2)}if(u!==o.length)throw new Error("Invalid encoding. Premature ending reached");return{...t,polyline:s}}function Nt(e){let o=e.charCodeAt(0);return It[o-45]}function At(e){let o=h(0),t=h(0),n=[];if(e.split("").forEach(i=>{let r=h(Nt(i));o|=(r&h(31))<<t,(r&h(32))===h(0)?(n.push(o),o=h(0),t=h(0)):t+=h(5)}),t>0)throw new Error("Invalid encoding");return n}function Gt(e,o){if(+e.toString()!==_t)throw new Error("Invalid format version");let t=+o.toString(),n=t&15,i=t>>4&7,r=t>>7&15;return{precision:n,thirdDim:i,thirdDimPrecision:r}}function z(e){let o=e;return o&h(1)&&(o=~o),o>>=h(1),+o.toString()}var le={decodeIsoline:se,geometryFunction:Vt};function Vt(e,o,t){let n=new ol.geom.Circle(e,t.range*1e3),i=ol.proj.transform(e,`EPSG:${o.mapview.srid}`,"EPSG:4326"),r={"range[type]":t["range[type]"],"range[values]":t.range*60,transportMode:t.transportMode,optimizeFor:t.optimizeFor,origin:`${i[1]},${i[0]}`};return t.dateISO&&(r[t.reverseDirection&&"arrivalTime"||"departureTime"]=new Date(t.dateISO).toISOString()),mapp.utils.xhr(`${o.mapview.host}/api/proxy?url=${encodeURIComponent(`https://isoline.router.hereapi.com/v8/isolines?${mapp.utils.paramString(r)}&{HERE}`)}`).then(a=>{if(!a.isolines)return console.log(a),alert("Query failed.");let l=se(a.isolines[0].polygons[0].outer);l.polyline.forEach(s=>s.reverse()),l.polyline.push(l.polyline[0]);let c=o.mapview.interaction.format.readFeature({type:"Feature",geometry:{type:"Polygon",coordinates:[l.polyline]}},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+o.mapview.srid});o.mapview.interaction.Layer.getSource().clear(),o.mapview.interaction.Layer.getSource().addFeature(c)}),n}var ae=(e,o)=>isNaN(o)?e:e.length===7?e+parseInt(o*255).toString(16):e.length===4?e+parseInt(o*15).toString(16):e;var ce=e=>{if(!!Array.isArray(e))return new Promise(o=>{let t=e.map(n=>new Promise((i,r)=>import(n).then(a=>{i(a)}).catch(r)));Promise.all(t).then(n=>{o(n)}).catch(o)})};var ue=(e,o,t)=>{let n=new ol.geom.Circle(e,t.minutes*1e3),i=ol.proj.transform(e,`EPSG:${o.mapview.srid}`,"EPSG:4326");return mapp.utils.xhr(`https://api.mapbox.com/isochrone/v1/mapbox/${t.profile}/${i.join(",")}?${mapp.utils.paramString({contours_minutes:t.minutes,polygons:!0,access_token:t.access_token})}`).then(r=>{if(!r.features)return;let a=o.mapview.interaction.format.readFeature({type:"Feature",geometry:r.features[0].geometry},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+o.mapview.srid});o.mapview.interaction.Layer.getSource().clear(),o.mapview.interaction.Layer.getSource().addFeature(a)}),n};function pe(e,o={}){navigator.geolocation.getCurrentPosition(e,t=>console.error(t),o)}function E(e,...o){if(!o.length)return e;let t=o.shift();if(I(e)&&I(t))for(let n in t)I(t[n])?(e[n]||Object.assign(e,{[n]:{}}),E(e[n],t[n])):Object.assign(e,{[n]:t[n]});return E(e,...o)}function I(e){return e&&typeof e=="object"&&!Array.isArray(e)}var de=e=>Object.entries(e).filter(o=>o[1]===0||!!o[1]).filter(o=>o[1]!=="{}").filter(o=>typeof o[1]!="object"||o[1].length||Object.values(o[1]).some(t=>typeof t=="object"&&Object.keys(t).length)).map(o=>(typeof o[1]=="object"&&!o[1].length&&(o[1]=JSON.stringify(o[1])),encodeURI(`${o[0]}=${o[1]}`))).join("&");var fe=e=>new Promise((o,t)=>{Promise.all(e).then(o).catch(n=>{console.error(n),t(n)})});var he=(e,o)=>e?(Array.isArray(e.icon?.layers)&&(e=e.icon.layers.map(n=>{let i=mapp.utils.clone(e);return Object.assign(i.icon,n),i})),Array.isArray(e)&&e.map(n=>me(n,o))||me(e,o)):void 0;function me(e,o){if(e.fill=e.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(e.fillColor,e.fillOpacity)}),e.stroke=e.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(e.strokeColor,e.strokeOpacity),width:parseFloat(e.strokeWidth||1)}),e.image=e.icon&&Bt(e.icon,o),e.image!==null)return e.text=e.label?.display&&e.label?.text&&new ol.style.Text({font:e.label.font||"12px sans-serif",text:String(e.label.text),overflow:e.label.overflow,stroke:e.label.strokeColor&&new ol.style.Stroke({color:e.label.strokeColor,width:e.label.strokeWidth||1}),fill:new ol.style.Fill({color:e.label.fillColor||"#000"})}),new ol.style.Style(e)}var _=new Map;function Bt(e,o){Object.assign(e,o&&o.getProperties());let t=e.scale||1;return t*=e.clusterScale||1,t*=e.zoomInScale||1,t*=e.zoomOutScale||1,t*=e.highlightScale||1,delete e.scale,delete e.clusterScale,delete e.zoomInScale,delete e.zoomOutScale,delete e.highlightScale,_.has(e)?e.url=_.get(e):(e.url=e.url||e.svg||mapp.utils.svgSymbols[e.type](e,o),_.set(e,e.url)),new ol.style.Icon({src:e.url,scale:t,anchor:e.anchor||[.5,.5]})}var A={};ot(A,{circle:()=>Kt,diamond:()=>Ht,dot:()=>Rt,markerColor:()=>Jt,markerLetter:()=>Wt,semiCircle:()=>Dt,square:()=>qt,target:()=>Zt,template:()=>Xt,triangle:()=>Ut});var w=new XMLSerializer;function Rt(e){let o=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Zt(e){let o=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(f.node`<circle cx=12 cy=12 r=${parseFloat(t[0])*10} fill=${t[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Ut(e){let o=f.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return o.appendChild(f.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(t=>{function n(a,l){return 12+(a-12)*l}function i(a,l){return 16+(a-16)*l}let r=`${n(12,t[0])},${i(4.68,t[0])} ${n(2,t[0])}, ${i(22,t[0])} ${n(22,t[0])}, ${i(22,t[0])}`;o.appendChild(f.node`
      <polygon
        points="${r}"
        fill=${t[1]}
        stroke=${t[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function qt(e){let o=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(f.node`
      <rect fill=${t[1]}
        width=${parseFloat(t[0])*20}
        height=${parseFloat(t[0])*20}
        x=${10*(1-parseFloat(t[0]))}
        y=${10*(1-parseFloat(t[0]))} rx=${parseFloat(t[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Ht(e){let o=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function t(n,i){return 12+(n-12)*i}return e.layers&&Object.entries(e.layers).forEach(n=>{let i=`${t(12,n[0])} ${t(0,n[0])},${t(24,n[0])} ${t(12,n[0])},${t(12,n[0])} ${t(24,n[0])}, ${t(0,n[0])} ${t(12,n[0])}`;o.appendChild(f.node`
      <polygon
        fill=${n[1]||"#FFF"}
        points="${i}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Dt(e){let o=f.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(f.node`
      <circle cx=10 cy=10 r=${parseFloat(t[0])*10} fill=${t[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Wt(e){let o=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Jt(e){let o=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Kt(e){let o=f.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(o))}`}function Xt(e,o){let t=Object.assign({},e.params,o.getProperties()),n=e.template;for(let i of Object.entries(t))n=n.replaceAll(i[0],i[1]);return`data:image/svg+xml,${encodeURIComponent(n)}`}var ge=e=>{let o=e.getGeometry(),t=o.getCoordinates(),n=o.getType();if(!!t){if(n==="Point")return new ol.geom.Point(o.getCoordinates());if(n==="LineString")return new ol.geom.MultiPoint(o.getCoordinates());var i=n==="MultiPolygon"&&o.getCoordinates()[0]||o.getCoordinates(),r=new ol.geom.MultiPoint(i[0]);return r}};var G=new Map,we=e=>new Promise((o,t)=>{if(!e)return t();if(e=typeof e=="string"?{url:e}:e,e.cache&&G.has(e))return o(G.get(e));let n=new XMLHttpRequest;n.open(e.method||"GET",e.url);let i={"Content-Type":"application/json"};Object.assign(i,e.requestHeader||{}),Object.entries(i).forEach(r=>n.setRequestHeader(...r)),n.responseType=e.responseType||"json",n.onload=r=>{if(r.target.status>=300){t(new Error(r.target.status));return}e.cache&&G.set(e,r.target.response),o(r.target.response)},n.send(e.body)});var Qt=(e,o)=>e.size===o.size&&[...e].every(t=>o.has(t)),Yt=(...e)=>o=>e.reduce((t,n)=>n(t),o),ye={render:oe,html:ne,svg:f,areSetsEqual:Qt,clone:$,compose:Yt,copyToClipboard:re,dataURLtoBlob:ie,getCurrentPosition:pe,here:le,hexa:ae,loadPlugins:ce,mapboxGeometryFunction:ue,merge:E,paramString:de,promiseAll:fe,style:he,svgSymbols:A,verticeGeoms:ge,xhr:we};var d={current:{layers:[],locations:[]},set:to,parse:eo,remove:xe,removeAll:oo,push:no,filter:ro},L=d;function eo(){window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(e,o,t)=>{d.current[o]?d.current[o]=decodeURI(t).split(","):d.current[o]=decodeURI(t)}),d.current.token&&(window.history.replaceState({},document.title,window.location.href.replace(new RegExp(`token=${d.current.token}`),"")),delete d.current.token)}function to(e){Object.assign(d.current,e),C()}function xe(e){Array.isArray(d.current[e])?d.current[e].length=0:delete d.current[e],C()}function oo(){Object.keys(d.current).forEach(e=>xe(e)),C()}function no(e,o){d.current[e]?d.current[e].indexOf(o)<0&&d.current[e].push(o):d.current[e]=[o],C()}function ro(e,o){d.current[e]=d.current[e].filter(t=>t!==o),C()}function C(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(d.current)}`)}catch(e){console.log(e)}}var be={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var ve={save:"Speichern",cancel:"Abbrechen",invalid_geometry:"Ungültige Geometrie",confirm_delete:"Bestätigung des Löschvorgang"};var Se={save:"Enregister",cancel:"Annuler",no_results:"Aucun resultat pour cette recherche"};var ke={save:"Zapisz",cancel:"Anuluj",no_results:"Nic nie znaleziono"};var je={save:"保存",cancel:"キャンセル",no_results:"結果なし"};var Ee={save:"저장",cancel:"취소",no_results:"검색결과 없음"};var Ce={save:"保存",cancel:"取消",no_results:"未找到相关地点"};var Me={en:be,de:ve,fr:Se,pl:ke,ja:je,ko:Ee,zh:Ce};function N(){this.display=!0,this.view?.dispatchEvent(new Event("displayTrue")),this.mapview.Map.removeLayer(this.L),this.mapview.Map.addLayer(this.L),typeof this.reload=="function"&&this.reload(),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.push("layers",this.key)}function V(){this.display=!1,this.view?.dispatchEvent(new Event("displayFalse")),this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.filter("layers",this.key)}function B(){if(!this.tables)return this.table;let e,o=parseInt(this.mapview.Map.getView().getZoom()),t=Object.keys(this.tables),n=parseInt(t[0]),i=parseInt(t[t.length-1]);return e=this.tables[o],e=o<n?this.tables[n]:e,e=o>i?this.tables[i]:e,e}function R(){return this.tables?Object.values(layer.tables).reverse().find(e=>!!e):this.table}function Z(){return this.tables?Object.values(layer.tables).find(e=>!!e):this.table}function $e(e){return mapp.layer.format[e.format]&&mapp.layer.format[e.format](e),Object.assign(e,{show:N,hide:V,tableCurrent:B,tableMax:R,tableMin:Z,zoomToExtent:so}),e.hover&&typeof e.hover!="function"&&io(e),e.filter=e.filter||{},e.filter.current=e.filter.current||{},e.style&&e.style.themes&&(e.style.theme=e.style.theme||e.style.themes[Object.keys(e.style.themes)[0]]),Object.keys(e).forEach(o=>{mapp.plugins[o]&&mapp.plugins[o](e)}),e}function io(e){let o=e.hover.field,t=e.hover.query||"infotip";e.hover=()=>mapp.utils.xhr(`${e.mapview.host}/api/query?`+mapp.utils.paramString({dbs:e.dbs,locale:e.mapview.locale.key,layer:e.key,template:t,qID:e.qID,id:e.highlight,table:e.tableCurrent(),geom:e.geom,field:o,coords:e.format==="cluster"&&ol.proj.transform(e.mapview.interaction.current.F.getGeometry().getCoordinates(),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`)})).then(n=>{!e.mapview.position||!n||n.label!=""&&e.mapview.infotip(n.label)})}async function so(e){let o=this,t=await mapp.utils.xhr(`${o.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:o.dbs,locale:o.mapview.locale.key,layer:o.key,table:o.table||Object.values(o.tables)[0]||Object.values(o.tables)[1],geom:o.geom,proj:o.srid,srid:o.mapview.srid,filter:o.filter.current})),n=/\((.*?)\)/.exec(t.box2d)[1].replace(/ /g,",");o.mapview.fitView(n.split(",").map(i=>parseFloat(i)),e)}var Le=e=>o=>{let t=o.getProperties();if(e.type==="cluster"&&(t.count=o.get("features").length),e.featureLookup){let c=e.featureLookup.find(s=>s.id===t.id);if(!c)return;Object.assign(t,c)}let n=Object.assign({},e.style.default,t.count&&t.count>1&&e.style.cluster||{},e.style.theme?.style||{});Object.assign(n,{label:e.style.label||null});let i=o.getGeometry().getType();if(i==="Point"){if(typeof n.icon=="function")return n.icon(o);n.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),n.icon=Object.assign({},n.icon||mapp.utils.clone(n))}else delete n.icon;delete n.scale,delete n.clusterScale;let r=e.style.theme;if(r&&r.type==="categorized"){var a=t.cat||t[r.field],l=r.cat&&(r.cat[a]?.style||r.cat[a]);typeof l!="undefined"&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(n,l))}if(r&&r.type==="graduated"){var a=parseFloat(t.cat||t[r.field]);if(!isNaN(a)){for(let s=0;s<r.cat_arr.length&&!(a<parseFloat(r.cat_arr[s].value));s++)var l=r.cat_arr[s].style||r.cat_arr[s];l&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(n,l))}}if(n.icon?.clusterScale&&(n.icon.clusterScale=e.style.logScale?Math.log(n.icon.clusterScale)/Math.log(e.max_size)*Math.log(t.size||t.count):1+n.icon.clusterScale/e.max_size*(t.size||t.count)),n.icon?.zoomInScale&&(n.icon.zoomInScale*=e.mapview.Map.getView().getZoom()),n.icon?.zoomOutScale&&(n.icon.zoomOutScale/=e.mapview.Map.getView().getZoom()),e.highlight&&e.highlight===o.get("id")){let c=mapp.utils.clone(e.style.highlight);i==="Point"?(c.icon=c.icon||c.marker||mapp.utils.clone(c),c.icon.highlightScale=c.icon.scale||1,delete c.icon.scale,delete c.scale):delete c.icon,mapp.utils.merge(n,c)}if(n.label&&(n.label.text=t.label||n.label.count&&t.count>1&&t.count,!n.label?.display&&delete n.label,n.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete n.label,n.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete n.label),!(e.mapview?.locations[`${e.key}!${t.id}`]&&(e.style.selected&&mapp.utils.merge(n,e.style.selected,{zIndex:Infinity}),e.style.selected===null)))return mapp.utils.style(n,o)};import lo from"https://cdn.skypack.dev/pin/maplibre-gl@v1.15.2-vB8RUOzTJK9WkLajH5fD/mode=imports,min/optimized/maplibre-gl.js";var Fe=e=>{let o=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=new lo.Map({container:o,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1}),e.L=new ol.layer.Layer({zIndex:e.zIndex,render:t=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(t.viewState.center),zoom:t.viewState.zoom-1,bearing:-t.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var Te=e=>{let o=e.proxy&&`${e.mapview.host}/api/proxy?url=${e.URI}`||e.URI,t=new ol.source.OSM({url:decodeURIComponent(o),opaque:!1,transition:0});e.L=new ol.layer.Tile({source:t,layer:e,zIndex:e.style.zIndex||0})};var Pe=e=>{e.reload=()=>{o.refresh()};let o=new ol.source.VectorTile({format:new ol.format.MVT({}),transition:0,cacheSize:0,tileUrlFunction:t=>{let n=e.tableCurrent();return n?`${e.mapview.host}/api/layer/mvt/${t[0]}/${t[1]}/${t[2]}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:n,filter:e.filter&&e.filter.current}):o.clear()}});e.L=new ol.layer.VectorTile({key:e.key,source:o,renderBuffer:200,zIndex:e.style.zIndex||1,style:mapp.layer.style(e)})};var Oe=e=>{e.highlight=!0,e.reload=o;function o(){if(!e.display)return;e.xhr&&e.xhr.abort();let t=e.tableCurrent();if(!t){e.L.getSource().clear();return}let n=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/cluster/${e.mapview.Map.getView().getZoom()}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:t,kmeans:e.cluster_kmeans||void 0,dbscan:e.cluster_dbscan||void 0,resolution:e.cluster_resolution||void 0,hexgrid:e.cluster_hexgrid,theme:e.style.theme?.type,size:e.style.theme?.size,cat:e.style.theme?.fieldfx||e.style.theme?.field,aggregate:e.style.theme?.aggregate,label:e.style.label?.field,label_template:e.style.label?.template,filter:e.filter?.current,viewport:[n[0],n[1],n[2],n[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let r=i.target.response;e.max_size=r.reduce((c,s)=>Math.max(c,s.properties.size||s.properties.count),0);let a=1,l=r.map(c=>new ol.Feature(Object.assign({id:a++,geometry:new ol.geom.Point(e.srid==4326&&ol.proj.fromLonLat([c.geometry.x,c.geometry.y])||[c.geometry.x,c.geometry.y])},c.properties)));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:l}))},e.xhr.send()}e.L=new ol.layer.Vector({key:e.key,layer:e,zIndex:e.style.zIndex||10,style:mapp.layer.style(e)}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",o)};var ao=new ol.format.GeoJSON,ze=e=>{e.reload=o;function o(){mapp.utils.xhr(`${e.mapview.host}/api/layer/geojson?${mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:e.table,filter:e.filter&&e.filter.current})}`).then(t=>{let n=t.map(a=>new ol.Feature({id:a.id,geometry:ao.readGeometry(a.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:a.properties})),i=new ol.source.Vector({features:n}),r=e.type==="cluster"&&new ol.source.Cluster({distance:e.cluster_distance,source:i});e.L.setSource(r||i)})}e.L=new ol.layer.Vector({key:e.key,zIndex:e.style.zIndex||1,style:e.styleFunction||mapp.layer.style(e)})};var Ie=e=>{e.grid_size=Object.values(e.grid_fields)[0],e.grid_color=Object.values(e.grid_fields)[1],e.grid_ratio=!1,e.reload=o;function o(){if(!e.display)return;e.xhr&&e.xhr.abort();let t=e.tableCurrent();if(!t){e.L.getSource().clear();return}let n=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/grid?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:t,size:e.grid_size,color:e.grid_color,viewport:[n[0],n[1],n[2],n[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let r=i.target.response;e.sizeAvg=0,e.colorAvg=0;let a=r.map(u=>{if(parseFloat(u[2])>0)return u[2]=isNaN(u[2])?u[2]:parseFloat(u[2]),u[3]=isNaN(u[3])?u[3]:parseFloat(u[3]),e.grid_ratio&&u[3]>0&&(u[3]/=u[2]),e.sizeAvg+=parseFloat(u[2]),e.colorAvg+=isNaN(u[3])?0:parseFloat(u[3]),new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([u[0],u[1]])),properties:{size:parseFloat(u[2]),color:isNaN(u[3])?u[3]:parseFloat(u[3])}})});function l(u,p,m){let g=u.filter(x=>isFinite(x[p]));return Math[m].apply(null,g.map(x=>x[p]))}e.sizeMin=l(r,2,"min"),e.sizeAvg/=a.length,e.sizeMax=l(r,2,"max"),e.colorMin=l(r,3,"min"),e.colorAvg/=a.length,e.colorMax=l(r,3,"max"),e.colorBins=[];let c=e.style.range.length;for(var s=1;s<c;s++)s<c/2&&e.colorBins.push(e.colorMin+(e.colorAvg-e.colorMin)/(c/2)*s),s===c/2&&e.colorBins.push(e.colorAvg),s>c/2&&e.colorBins.push(e.colorAvg+(e.colorMax-e.colorAvg)/(c/2)*(s-c/2));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:a})),e.style.legend?.dispatchEvent(new Event("update"))},e.xhr.send()}e.L=new ol.layer.Vector({zIndex:e.style.zIndex||1,style:t=>{let n=t.getProperties().properties,i=n.size<=e.sizeAvg?7+7/e.sizeAvg*n.size:14+7/(e.sizeMax-e.sizeAvg)*(n.size-e.sizeAvg);if(n.hxcolor=e.style.hxcolor||"#C0C0C0",parseFloat(n.color)){n.hxcolor=e.style.range[0];for(let r=0;r<e.colorBins.length&&!(n.color<e.colorBins[r]);r++)n.hxcolor=e.style.range[r+1]}return mapp.utils.style({icon:{type:"dot",fillColor:n.hxcolor,scale:i/30}})}}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",o)};var _e={mbtiles:Fe,tiles:Te,mvt:Pe,cluster:Oe,geojson:ze,grid:Ie};var Ae={decorate:$e,style:Le,format:_e};var Ge=e=>{Object.assign(e,{flyTo:po,Layers:[],remove:co,removeCallbacks:[],trash:fo,update:uo,updateCallbacks:[]})};function co(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.format==="mvt"?this.layer.L.changed():this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function uo(){let e={};if(this.infoj.filter(t=>typeof t.newValue!="undefined").forEach(t=>{t.type==="integer"&&(t.newValue=isNaN(parseInt(t.newValue))?null:t.newValue),t.type==="numeric"&&(t.newValue=isNaN(parseFloat(t.newValue))?null:t.newValue),Object.assign(e,{[t.field]:t.newValue})}),!Object.keys(e).length)return;await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/location/update?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)});let o=this.infoj.filter(t=>typeof t.newValue!="undefined").filter(t=>t.dependents&&t.dependents.length).map(t=>t.dependents).flat();if(this.infoj.filter(t=>typeof t.newValue!="undefined").forEach(t=>{t.value=t.newValue,delete t.newValue}),o.length){let t=await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:[...new Set(o)].join()}));this.infoj.filter(n=>typeof t[n.field]!="undefined").forEach(n=>{n.value=t[n.field]})}this.layer.reload(),this.updateCallbacks?.forEach(t=>typeof t=="function"&&t(this))}function po(){let e=new ol.source.Vector;this.Layers.forEach(o=>{let t=o.getSource();typeof t.getFeatures=="function"&&e.addFeatures(t.getFeatures())}),this.layer.mapview.fitView(e.getExtent())}async function fo(){!confirm(mapp.dictionary.confirm_delete)||(await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/delete?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.layer.reload(),this.remove())}async function Ne(e,o=e.layer.mapview.locations){if(!e.layer||!e.id)return;if(e.table=e.table||e.layer.table||Object.values(e.layer.tables).find(i=>!!i),e.hook=`${e.layer.key}!${e.id}`,o[e.hook]){o[e.hook].remove(),delete o[e.hook];return}let t=await mapp.utils.xhr(`${e.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.table,id:e.id})),n=e.layer.infoj.map(i=>{let r=mapp.utils.clone(i);return Object.assign(r,{title:t[r.field+"_label"]||r.title,value:t[r.field],location:e}),r});return mapp.location.decorate(Object.assign(e,{infoj:n})),o[e.hook]=e,e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}var Ve=async e=>(e.id=await mapp.utils.xhr({method:"POST",url:`${e.layer.mapview.host}/api/location/new?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.layer.tableCurrent()}),body:JSON.stringify({geometry:e.geometry})}),e);async function Be(e){let o=e.feature.getProperties(),t=e.feature.getGeometry(),n=t.getCoordinates(),i=ol.proj.transform(n,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),r=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,cluster_label:e.layer.cluster_label||e.layer.qID,table:e.table,n:o.count>(e.max||99)?e.max||99:o.count,x:i[0],y:i[1],coords:i})),a=mapp.utils.html.node`
    <div style="
      max-width: 66vw;
      max-height: 300px;
      overflow-x: hidden;">
      <ul>
      ${r.map(l=>mapp.utils.html.node`
        <li
          onclick=${c=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:l.id,marker:ol.proj.transform(l.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${l.label||'"'+e.layer.cluster_label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(i,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:a,autoPan:!0})}var Re={decorate:Ge,create:Ve,get:Ne,nnearest:Be};function Ze(e){if(!Array.isArray(e))return;let o=this.hooks&&mapp.hooks.current.layers.length;return e.forEach((t,n)=>{let i=mapp.utils.clone(t);i.mapview=this,o&&(i.display=!!~mapp.hooks.current.layers.indexOf(i.key)),mapp.layer.decorate(i),this.layers[i.key]=i,i.display&&i.show()}),e}function Ue(e,o={}){this.Map.getView().fit(e,Object.assign({padding:[50,50,50,50],duration:1e3},o))}function qe(e){let o=this.Map.getView().calculateExtent();if(!e)return{south:o[1],west:o[0],north:o[3],east:o[2]};let t=ol.proj.transformExtent(o,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:t[1],west:t[0],north:t[3],east:t[2]}}var mo=new ol.format.GeoJSON;function He(e){let o=e.geometry&&mo.readFeature({type:"Feature",geometry:e.geometry},{dataProjection:`EPSG:${e.dataProjection||this.srid}`,featureProjection:`EPSG:${this.srid}`}),t=new ol.source.Vector;o&&t.addFeature(o);let n=new ol.layer.Vector({source:t,zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(n),n}var y={};function De(e){let o=this;if(y.node?.remove(),o.Map.un("pointermove",t),!e)return;y.node=mapp.utils.html.node`<div class="infotip">`,y.node.innerHTML=e,o.Map.getTargetElement().appendChild(y.node),o.Map.on("pointermove",t);function t(){y.node.style.opacity=1,y.node.style.left=o.pointerLocation.x-y.node.offsetWidth/2+"px",y.node.style.top=o.pointerLocation.y-y.node.offsetHeight-15+"px"}}var U;function We(e){let o=Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e);if(U=!U,o.L||(o.L=new ol.layer.Vector({source:new ol.source.Vector({features:[o.feature]}),zIndex:40,style:mapp.utils.style({icon:o.icon})})),!U){this.Map.removeLayer(o.L);return}this.Map.addLayer(o.L),mapp.utils.getCurrentPosition(t=>{let n=ol.proj.fromLonLat([parseFloat(t.coords.longitude),parseFloat(t.coords.latitude)]);o.feature.getGeometry().setCoordinates(n),this.Map.getView().animate({center:n},{zoom:this.locale.maxZoom})})}var b={};function Je(e){let o=this;b.node?.remove(),!!e&&(b.node=mapp.utils.html.node`<div class="popup">`,b.node.appendChild(e.content),b.overlay&&o.Map.removeOverlay(b.overlay),b.overlay=new ol.Overlay({element:b.node,position:e.coords||o.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),o.Map.addOverlay(b.overlay))}function Ke(e){let o=this;o.interaction?.finish();let t=Object.assign({type:"highlight",finish:n,clear:a,highlight:r,getLocation:c,hitTolerance:5,candidateKeys:new Set,layerFilter:s=>Object.values(o.layers).some(u=>u.qID&&u.L===s)},e);o.interaction=t,o.Map.on("pointermove",i),o.Map.on("singleclick",l),o.Map.getTargetElement().addEventListener("mouseout",a),o.Map.getTargetElement().style.cursor="auto";function n(){delete o.interaction,o.Map.un("pointermove",i),o.Map.un("singleclick",l),o.Map.getTargetElement().removeEventListener("mouseout",a)}function i(s){let u,p={};if(o.Map.forEachFeatureAtPixel(s.pixel,(m,g)=>{let x={key:`${g.get("key")||ol.util.getUid(g)}!${m.get("id")||ol.util.getUid(m)}`,F:m,L:g};p[x.key]=x},{layerFilter:t.layerFilter,hitTolerance:t.hitTolerance}),mapp.utils.areSetsEqual(t.candidateKeys,new Set(Object.keys(p))))return t.highlight("noChange",s);u=p[Object.keys(p).find(m=>!t.candidateKeys.has(m))],u=u||t.current?.key&&p[t.current?.key]||p[Object.keys(p)[0]],t.candidateKeys=new Set(Object.keys(p)),t.highlight(u,s)}function r(s,u){s!=="noChange"&&(a(),!!s&&(t.current=Object.assign(s,{layer:o.layers[s.L.get("key")],id:s.F.get("id")}),t.current.layer.highlight=s.id,typeof s.F.set=="function"&&s.F.set("highlight",!0),u.originalEvent.pointerType!=="touch"&&(t.current.layer.infoj&&(o.Map.getTargetElement().style.cursor="pointer"),t.current.layer.hover&&t.current.layer.hover(s.F),typeof t.current.F.setStyle=="function"?(s.F.set("highlight",!0),t.current.F.setStyle()):t.current.layer.style.highlight&&t.current.layer.L.changed())))}function a(){!t.current||(o.infotip(null),o.Map.getTargetElement().style.cursor="auto",delete t.current.layer.highlight,typeof t.current.F.setStyle=="function"?(feature.F.set("highlight",!1),t.current.F.setStyle()):t.current.layer.style.highlight&&t.current.layer.L.changed(),delete t.current)}async function l(s){s.originalEvent.pointerType==="touch"&&i(s),o.popup(null),t.current&&t.getLocation(t.current)}function c(s){if(s.F.getProperties().count>1){mapp.location.nnearest({mapview:o,layer:s.layer,table:s.layer.table||s.layer.tableCurrent(),feature:s.F});return}mapp.location.get({layer:s.layer,table:s.layer.table||s.layer.tableCurrent(),id:s.layer.highlight})}}function Xe(e){let o=this;o.interaction?.finish();let t=Object.assign({type:"draw",finish:a,format:new ol.format.GeoJSON,Layer:new ol.layer.Vector({source:new ol.source.Vector}),contextMenu:mapp.ui?.elements.contextMenu.draw.bind(o),metricFunction:i,vertices:[],srid:o.srid,getFeature:r,style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);o.Map.getTargetElement().style.cursor="crosshair",o.Map.addLayer(t.Layer),t.interaction=new ol.interaction.Draw({source:t.Layer.getSource(),geometryFunction:t.geometryFunction,freehand:t.freehand,type:t.type,style:t.style,condition:l=>{if(t.kinks)return!1;if(l.originalEvent.buttons===1)return t.vertices.push(l.coordinate),o.popup(null),typeof t.condition=="function"&&t.condition(l),!0}}),t.interaction.on("drawstart",l=>{t.tooltip&&t.metricFunction(l.feature.getGeometry(),t.tooltip),l.feature.setStyle(t.style),t.Layer.getSource().clear(),o.popup(null)}),t.interaction.on("drawend",l=>{if(t.drawend)return t.drawend(l);typeof t.contextMenu=="function"&&setTimeout(t.contextMenu,400)}),o.interaction=t,o.Map.addInteraction(t.interaction),t.snap&&(t.snapSource=new ol.source.Vector,o.Map.on("pointermove",n),t.snapInteraction=new ol.interaction.Snap({source:t.snapSource}),o.Map.addInteraction(t.snapInteraction)),typeof t.contextMenu=="function"&&o.Map.getTargetElement().addEventListener("contextmenu",t.contextMenu);function n(l){let c=new Set;o.Map.forEachFeatureAtPixel(l.pixel,s=>{let u=s.getGeometry();c.has(u)||(c.add(u),t.snapSource.addFeature(new ol.Feature(u)))},{hitTolerance:2})}function i(l,c){let s={distance:()=>ol.sphere.getLength(new ol.geom.LineString([l.getInteriorPoint().getCoordinates(),_xyz.mapview.position])),area:()=>ol.sphere.getArea(l),length:()=>ol.sphere.getLength(l)};!s[c]||l.on("change",()=>{o.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">${parseInt(s[c]()).toLocaleString("en-GB")+(c==="area"?"sqm":"m")}`})})}function r(){let l=t.Layer.getSource().getFeatures();return JSON.parse(t.format.writeFeature(l[0],{dataProjection:"EPSG:"+t.srid,featureProjection:"EPSG:"+o.srid}))}function a(l){delete o.interaction,t.callback&&t.callback(l),o.popup(null),typeof t.contextMenu=="function"&&o.Map.getTargetElement().removeEventListener("contextmenu",t.contextMenu),t.snapInteraction&&(o.Map.un("pointermove",n),o.Map.removeInteraction(t.snapInteraction),delete t.snapInteraction),o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Layer.getSource().clear(),o.Map.getTargetElement().style.cursor="default"}}function Qe(e){let o=this;o.interaction?.finish(),o.interaction?.type==="highlight"&&o.interaction.finish();let t=Object.assign({type:"modify",finish:i,format:new ol.format.GeoJSON,Source:new ol.source.Vector,vertices:[],srid:o.srid,contextMenu:mapp.ui?.elements.contextMenu.modify.bind(o),getFeature:n,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);o.Map.getTargetElement().style.cursor="crosshair",t.Feature&&t.Source.addFeature(t.Feature),t.Layer=new ol.layer.Vector({source:t.Source,zIndex:9999,style:t.Style}),o.Map.addLayer(t.Layer),t.interaction=new ol.interaction.Modify({source:t.Source,deleteCondition:r=>{if(r.type==="singleclick"){let a=t.Feature.getGeometry(),l=a.getType();if(l==="Point")return;let c=a.getCoordinates();if(l==="LineString"&&c.length<3||c[0].length<=4)return;o.popup({coords:t.Feature.getGeometry().getClosestPoint(r.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{t.interaction.removePoint(),t.vertices.push(t.Feature.getGeometry().getClosestPoint(r.coordinate))}}>${mapp.dictionary.delete_vertex}`})}}}),t.interaction.on("modifystart",r=>{o.popup(null)}),t.interaction.on("modifyend",r=>{if(t.vertices.push(r.mapBrowserEvent.coordinate),t.modifyend)return t.modifyend(r,t);typeof t.contextMenu=="function"&&setTimeout(t.contextMenu,400)}),o.interaction=t,o.Map.addInteraction(t.interaction);function n(){return JSON.parse(t.format.writeFeature(t.Feature,{dataProjection:"EPSG:"+t.srid,featureProjection:"EPSG:"+o.srid}))}function i(r){delete o.interaction,t.callback&&t.callback(r),o.popup(null),o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Source.clear(),o.Map.getTargetElement().style.cursor="default"}}function Ye(e){let o=this;o.interaction?.finish();let t={finish:n,Layer:new ol.layer.Vector({source:new ol.source.Vector})};o.interaction=t,t.callback=e.callback,t.Layer.getSource().clear(),o.Map.addLayer(t.Layer),o.Map.getTargetElement().style.cursor="zoom-in",t.interaction=new ol.interaction.Draw({source:t.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ddd",width:1}),fill:new ol.style.Stroke({color:"#fff9"})})}),t.interaction.on("drawend",i=>{o.fitView(i.feature.getGeometry().getExtent()),n()}),o.Map.addInteraction(t.interaction);function n(){delete o.interaction,t.callback&&(t.callback(),delete t.callback),o.Map.getTargetElement().style.cursor="auto",o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Layer.getSource().clear()}}var et=e=>{Object.assign(e,{srid:e.locale.srid||"3857",addLayer:Ze,fitView:Ue,geoJSON:He,getBounds:qe,infotip:De,locate:We,popup:Je,layers:{},locations:{},interactions:{highlight:Ke.bind(e),draw:Xe.bind(e),modify:Qe.bind(e),zoom:Ye.bind(e)}});let o=mapp.hooks?.current?.z||e.locale.view?.z||e.locale.minZoom||0,t=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.locale.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.locale.view?.lat||0)]);e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent");let n=e.locale.extent&&ol.proj.transformExtent([parseFloat(e.locale.extent.west||-180),parseFloat(e.locale.extent.south||-90),parseFloat(e.locale.extent.east||180),parseFloat(e.locale.extent.north||90)],"EPSG:4326",`EPSG:${e.srid}`);if(e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults({mouseWheelZoom:e.scrollWheelZoom||!1,PinchRotate:{threshold:3}}),controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:o,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:t,extent:n})}),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let r=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],a=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],l=new ol.Feature({geometry:new ol.geom.Polygon([r,a]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[l]}),style:new ol.style.Style({fill:new ol.style.Fill({color:"#00000044"})}),zIndex:Infinity}))}e.scalebar&&e.Map.addControl(new ol.control.ScaleLine({units:e.scalebar})),e.attribution&&(typeof e.attribution!="object"&&(e.attribution={}),e.attribution.target=e.attribution.target||e.Map.getTargetElement().appendChild(mapp.utils.html.node`
          <div class="attribution-links">`),e.attribution.check=()=>{let r=Object.assign({},e.attribution.links||{});Object.values(e.layers).forEach(a=>{a.display&&a.attribution&&Object.assign(r,a.attribution)}),mapp.utils.render(e.attribution.target,mapp.utils.html`${Object.entries(r).map(a=>mapp.utils.html`
              <a class="background-fade" target="_blank" href="${a[1]}">${a[0]}`)}`)}),e.Map.on("pointermove",r=>{e.position=r.coordinate,e.pointerLocation={x:r.originalEvent.clientX,y:r.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.hooks)return;let r=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:r[1],lng:r[0],z:e.Map.getView().getZoom()})});let i;return e.Map.on("moveend",()=>{clearTimeout(i),i=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),e};L.parse();var v={version:"4.β",hash:"7ff5d0c9825f4e39609f2cef993e0903b70f63b0",language:L.current.language||"en",dictionaries:Me,dictionary:new Proxy({},{get:function(e,o,t){return v.dictionaries[v.language][o]?v.dictionaries[v.language][o]:v.dictionaries.en[o]}}),hooks:L,layer:Ae,location:Re,Mapview:et,plugins:{},utils:ye};window.mapp=v;var ho=v;export{ho as default};
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=mapp.js.map
