var Tt=Object.defineProperty;var zt=(e,o)=>{for(var t in o)Tt(e,t,{get:o[t],enumerable:!0})};var A=class extends Map{set(o,t){return super.set(o,t),t}},S=class extends WeakMap{set(o,t){return super.set(o,t),t}};var Pt=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Ot=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,It=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,At=/[\x01\x02]/g,ue=(e,o,t)=>{let r=0;return e.join("").trim().replace(Ot,(i,n,s,l)=>{let c=n+s.replace(It,"=$2$1").trimEnd();return l.length&&(c+=t||Pt.test(n)?" /":"></"+n),"<"+c+">"}).replace(At,i=>i===""?"<!--"+o+r+++"-->":o+r++)};var qo=1,Ro=111,Gt=({firstChild:e,lastChild:o})=>{let t=document.createRange();return t.setStartAfter(e),t.setEndAfter(o),t.deleteContents(),e},de=(e,o)=>e.nodeType===111?1/o<0?o?Gt(e):e.lastChild:o?e.valueOf():e.firstChild:e,fe=e=>{let{firstChild:o,lastChild:t}=e;if(o===t)return t||e;let{childNodes:r}=e,i=[...r];return{ELEMENT_NODE:1,nodeType:111,firstChild:o,lastChild:t,valueOf(){return r.length!==i.length&&e.append(...i),e}}};var{isArray:B}=Array,{indexOf:_t,slice:Nt}=[];var me=!1,G=class{constructor(o,t){me=!0,this._=(...r)=>o(...r,t)}},Wo=(e,o)=>new G(e,o),he=e=>o=>{for(let t in o){let r=t==="role"?t:`aria-${t}`,i=o[t];i==null?e.removeAttribute(r):e.setAttribute(r,i)}},ge=(e,o)=>{let t,r=!0,i=document.createAttributeNS(null,o);return n=>{if(t!==n)if(t=n,t==null)r||(e.removeAttributeNode(i),r=!0);else{let s=me&&n instanceof G?n._(e,o):n;s==null?(r||e.removeAttributeNode(i),r=!0):(i.value=s,r&&(e.setAttributeNodeNS(i),r=!1))}}},we=(e,o,t)=>r=>{t!==!!r&&((t=!!r)?e.setAttribute(o,""):e.removeAttribute(o))},Vt=({dataset:e})=>o=>{for(let t in o){let r=o[t];r==null?delete e[t]:e[t]=r}},q=(e,o)=>{let t,r,i=o.slice(2);return!(o in e)&&(r=o.toLowerCase())in e&&(i=r.slice(2)),n=>{let s=B(n)?n:[n,!1];t!==s[0]&&(t&&e.removeEventListener(i,t,s[1]),(t=s[0])&&e.addEventListener(i,t,s[1]))}},ye=e=>{let o;return t=>{o!==t&&(o=t,typeof t=="function"?t(e):t.current=e)}},xe=(e,o)=>o==="dataset"?Vt(e):t=>{e[o]=t},be=e=>{let o;return t=>{o!=t&&(o=t,e.textContent=t??"")}};var ve=(e,o,t,r,i)=>{let n=t.length,s=o.length,l=n,c=0,u=0,a=null;for(;c<s||u<l;)if(s===c){let p=l<n?u?r(t[u-1],-0).nextSibling:r(t[l-u],0):i;for(;u<l;)e.insertBefore(r(t[u++],1),p)}else if(l===u)for(;c<s;)(!a||!a.has(o[c]))&&e.removeChild(r(o[c],-1)),c++;else if(o[c]===t[u])c++,u++;else if(o[s-1]===t[l-1])s--,l--;else if(o[c]===t[l-1]&&t[u]===o[s-1]){let p=r(o[--s],-1).nextSibling;e.insertBefore(r(t[u++],1),r(o[c++],-1).nextSibling),e.insertBefore(r(t[--l],1),p),o[s]=t[l]}else{if(!a){a=new Map;let p=u;for(;p<l;)a.set(t[p],p++)}if(a.has(o[c])){let p=a.get(o[c]);if(u<p&&p<l){let d=c,w=1;for(;++d<s&&d<l&&a.get(o[d])===p+w;)w++;if(w>p-u){let g=r(o[c],0);for(;u<p;)e.insertBefore(r(t[u++],1),g)}else e.replaceChild(r(t[u++],1),r(o[c++],-1))}else c++}else e.removeChild(r(o[c++],-1))}return t};var{isArray:C,prototype:Zt}=Array,{indexOf:R}=Zt,{createDocumentFragment:Bt,createElement:qt,createElementNS:Rt,createTextNode:U,createTreeWalker:D,importNode:H}=new Proxy(document,{get:(e,o)=>e[o].bind(e)}),Ut=e=>{let o=qt("template");return o.innerHTML=e,o.content},_,Dt=e=>{_||(_=Rt("http://www.w3.org/2000/svg","svg")),_.innerHTML=e;let o=Bt();return o.append(..._.childNodes),o},Se=(e,o)=>o?Dt(e):Ut(e);var Ht=({childNodes:e},o)=>e[o],L=(e,o,t)=>ve(e.parentNode,o,t,de,e),Wt=e=>{let o,t,r=[],i=n=>{switch(typeof n){case"string":case"number":case"boolean":o!==n&&(o=n,t||(t=U("")),t.data=n,r=L(e,r,[t]));break;case"object":case"undefined":if(n==null){o!=n&&(o=n,r=L(e,r,[]));break}if(C(n)){o=n,n.length===0?r=L(e,r,[]):typeof n[0]=="object"?r=L(e,r,n):i(String(n));break}o!==n&&"ELEMENT_NODE"in n&&(o=n,r=L(e,r,n.nodeType===11?[...n.childNodes]:[n]));break;case"function":i(n(e));break}};return i},Jt=(e,o)=>{switch(o[0]){case"?":return we(e,o.slice(1),!1);case".":return xe(e,o.slice(1));case"@":return q(e,"on"+o.slice(1));case"o":if(o[1]==="n")return q(e,o)}switch(o){case"ref":return ye(e);case"aria":return he(e)}return ge(e,o)};function ke(e){let{type:o,path:t}=e,r=t.reduceRight(Ht,this);return o==="node"?Wt(r):o==="attr"?Jt(r,e.name):be(r)}var W=e=>{let o=[],{parentNode:t}=e;for(;t;)o.push(R.call(t.childNodes,e)),e=t,{parentNode:t}=e;return o},$="is\xB5",Me=new S,Kt=/^(?:textarea|script|style|title|plaintext|xmp)$/,M=()=>({stack:[],entry:null,wire:null}),Xt=(e,o)=>{let{content:t,updates:r}=Yt(e,o);return{type:e,template:o,content:t,updates:r,wire:null}},Qt=(e,o)=>{let t=e==="svg",r=ue(o,$,t),i=Se(r,t),n=D(i,129),s=[],l=o.length-1,c=0,u=`${$}${c}`;for(;c<l;){let a=n.nextNode();if(!a)throw`bad template: ${r}`;if(a.nodeType===8)a.data===u&&(s.push({type:"node",path:W(a)}),u=`${$}${++c}`);else{for(;a.hasAttribute(u);)s.push({type:"attr",path:W(a),name:a.getAttribute(u)}),a.removeAttribute(u),u=`${$}${++c}`;Kt.test(a.localName)&&a.textContent.trim()===`<!--${u}-->`&&(a.textContent="",s.push({type:"text",path:W(a)}),u=`${$}${++c}`)}}return{content:i,nodes:s}},Yt=(e,o)=>{let{content:t,nodes:r}=Me.get(o)||Me.set(o,Qt(e,o)),i=H(t,!0),n=r.map(ke,i);return{content:i,updates:n}},j=(e,{type:o,template:t,values:r})=>{let i=Ee(e,r),{entry:n}=e;(!n||n.template!==t||n.type!==o)&&(e.entry=n=Xt(o,t));let{content:s,updates:l,wire:c}=n;for(let u=0;u<i;u++)l[u](r[u]);return c||(n.wire=fe(s))},Ee=({stack:e},o)=>{let{length:t}=o;for(let r=0;r<t;r++){let i=o[r];i instanceof b?o[r]=j(e[r]||(e[r]=M()),i):C(i)?Ee(e[r]||(e[r]=M()),i):e[r]=null}return t<e.length&&e.splice(t),t},b=class{constructor(o,t,r){this.type=o,this.template=t,this.values=r}};var Ce=e=>{let o=new S,t=r=>(i,...n)=>j(r,{type:e,template:i,values:n});return Object.assign((r,...i)=>new b(e,r,i),{for(r,i){let n=o.get(r)||o.set(r,new A);return n.get(i)||n.set(i,t(M()))},node:(r,...i)=>j(M(),new b(e,r,i)).valueOf()})},Le=new S,J=(e,o)=>{let t=typeof o=="function"?o():o,r=Le.get(e)||Le.set(e,M()),i=t instanceof b?j(r,t):t;return i!==r.wire&&(r.wire=i,e.replaceChildren(i.valueOf())),e},K=Ce("html"),m=Ce("svg");function N(e,o=new WeakMap){if(e===null||typeof e!="object"||typeof e=="function"||e instanceof HTMLElement)return e;let t=Array.isArray(e)?[]:{};if(o.get(e))return o.get(e);o.set(e,t);for(let r in e)t[r]=N(e[r],o);return t}function $e(e){let o=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);o.value=e,o.select(),document.execCommand("copy"),o.remove()}function je(e){if(e.indexOf(";base64,")==-1){let n=e.split(","),s=n[0].split(":")[1],l=n[1];return new Blob([l],{type:s})}let o=e.split(";base64,"),t=o[0].split(":")[1],r=window.atob(o[1]),i=new Uint8Array(r.length);for(let n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return new Blob([i],{type:t})}var hr=5,Fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",eo=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Te=1,to=0,gr=1,wr=2,yr=3,xr=6,br=7,f=typeof BigInt<"u"?BigInt:Number;function ze(e){let o=ro(e),t=no(o[0],o[1]),r=10**t.precision,i=10**t.thirdDimPrecision,{thirdDim:n}=t,s=0,l=0,c=0,u=[],a=2;for(;a<o.length;){let p=X(o[a])/r,d=X(o[a+1])/r;s+=p,l+=d,n?(c+=X(o[a+2])/i,u.push([s,l,c]),a+=3):(u.push([s,l]),a+=2)}if(a!==o.length)throw new Error("Invalid encoding. Premature ending reached");return{...t,polyline:u}}function oo(e){let o=e.charCodeAt(0);return eo[o-45]}function ro(e){let o=f(0),t=f(0),r=[];if(e.split("").forEach(i=>{let n=f(oo(i));o|=(n&f(31))<<t,(n&f(32))===f(0)?(r.push(o),o=f(0),t=f(0)):t+=f(5)}),t>0)throw new Error("Invalid encoding");return r}function no(e,o){if(+e.toString()!==Te)throw new Error("Invalid format version");let t=+o.toString(),r=t&15,i=t>>4&7,n=t>>7&15;return{precision:r,thirdDim:i,thirdDimPrecision:n}}function X(e){let o=e;return o&f(1)&&(o=~o),o>>=f(1),+o.toString()}function vr({precision:e=5,thirdDim:o=to,thirdDimPrecision:t=0,polyline:r}){let i=10**e,n=10**t,s=io(e,o,t),l=[],c=f(0),u=f(0),a=f(0);return r.forEach(p=>{let d=f(Math.round(p[0]*i));l.push(Y(d-c)),c=d;let w=f(Math.round(p[1]*i));if(l.push(Y(w-u)),u=w,o){let g=f(Math.round(p[2]*n));l.push(Y(g-a)),a=g}}),[...s,...l].join("")}function io(e,o,t){if(e<0||e>15)throw new Error("precision out of range. Should be between 0 and 15");if(t<0||t>15)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(o<0||o>7||o===4||o===5)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");let r=t<<7|o<<4|e;return Q(Te)+Q(r)}function Q(e){let o="",t=f(e);for(;t>31;){let r=t&f(31)|f(32);o+=Fe[r],t>>=f(5)}return o+Fe[t]}function Y(e){let o=f(e),t=o<0;return o<<=f(1),t&&(o=~o),Q(o)}var Pe={decodeIsoline:ze,geometryFunction:so};function so(e,o,t){let r=new ol.geom.Circle(e,t.range*1e3),i=ol.proj.transform(e,`EPSG:${o.mapview.srid}`,"EPSG:4326"),n={"range[type]":t["range[type]"],"range[values]":t.range*60,transportMode:t.transportMode,optimizeFor:t.optimizeFor,origin:`${i[1]},${i[0]}`};return t.lat=i[1],t.lon=i[0],t.dateISO&&(n[t.reverseDirection&&"arrivalTime"||"departureTime"]=new Date(t.dateISO).toISOString()),mapp.utils.xhr(`${o.mapview.host}/api/proxy?url=${encodeURIComponent(`https://isoline.router.hereapi.com/v8/isolines?${mapp.utils.paramString(n)}&{HERE}`)}`).then(s=>{if(!s.isolines)return console.log(s),alert("Query failed.");let l=ze(s.isolines[0].polygons[0].outer);l.polyline.forEach(u=>u.reverse()),l.polyline.push(l.polyline[0]);let c=o.mapview.interaction.format.readFeature({type:"Feature",geometry:{type:"Polygon",coordinates:[l.polyline]}},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+o.mapview.srid});o.mapview.interaction.Layer.getSource().clear(),o.mapview.interaction.Layer.getSource().addFeature(c)}),r}var Oe=(e,o)=>isNaN(o)?e:e.length===7?e+(o&&parseInt(o*255).toString(16)||"00"):e.length===4?e+parseInt(o*15).toString(16):e;var Ie=e=>{if(!!Array.isArray(e))return new Promise(o=>{let t=e.map(r=>new Promise((i,n)=>import(r).then(s=>{i(s)}).catch(n)));Promise.all(t).then(r=>{o(r)}).catch(o)})};var Ae=(e,o,t)=>{let r=new ol.geom.Circle(e,t.minutes*1e3),i=ol.proj.transform(e,`EPSG:${o.mapview.srid}`,"EPSG:4326");return mapp.utils.xhr(`https://api.mapbox.com/isochrone/v1/mapbox/${t.profile}/${i.join(",")}?${mapp.utils.paramString({contours_minutes:t.minutes,polygons:!0,access_token:t.access_token})}`).then(n=>{if(!n.features)return;let s=o.mapview.interaction.format.readFeature({type:"Feature",geometry:n.features[0].geometry},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+o.mapview.srid});o.mapview.interaction.Layer.getSource().clear(),o.mapview.interaction.Layer.getSource().addFeature(s)}),r};function Ge(e,o={}){navigator.geolocation.getCurrentPosition(e,t=>console.error(t),o)}function F(e,...o){if(!o.length)return e;let t=o.shift();if(ee(e)&&ee(t))for(let r in t)ee(t[r])?(e[r]||Object.assign(e,{[r]:{}}),F(e[r],t[r])):Object.assign(e,{[r]:t[r]});return F(e,...o)}function ee(e){return e&&typeof e=="object"&&!Array.isArray(e)}var _e=e=>Object.entries(e).filter(o=>o[1]===0||!!o[1]).filter(o=>o[1]!=="{}").filter(o=>typeof o[1]!="object"||o[1].length||Object.values(o[1]).some(t=>typeof t=="object"&&Object.keys(t).length)).map(o=>(typeof o[1]=="object"&&!Array.isArray(o[1])&&(o[1]=JSON.stringify(o[1])),encodeURI(`${o[0]}=${o[1]}`))).join("&");var Ne=e=>new Promise((o,t)=>{Promise.all(e).then(o).catch(r=>{console.error(r),t(r)})});var Ve=e=>{e.queryparams=e.queryparams||{},e.queryparams.layer=e.queryparams.layer||e.viewport;let o=e.viewport&&e.layer.mapview.getBounds(),t=e.queryparams.center&&ol.proj.transform(e.layer.mapview.Map.getView().getCenter(),`EPSG:${_xyz.mapview.srid}`,"EPSG:4326");return Object.assign({},e.queryparams,{template:encodeURIComponent(e.query),filter:e.queryparams.filter&&e.layer.filter?.current,locale:e.queryparams.layer&&e.layer.mapview.locale.key,layer:e.queryparams.layer&&e.layer.key,id:e.queryparams?.id&&e.location?.id,lat:t&&t[1],lng:t&&t[0],z:e.queryparams?.z&&e.layer.mapview.Map.getView().getZoom(),viewport:o&&[o.west,o.south,o.east,o.north,e.layer.mapview.srid]})};var Be=(e,o)=>e?(Array.isArray(e.icon?.layers)&&(e=e.icon.layers.map(r=>{let i=mapp.utils.clone(e);return Object.assign(i.icon,r),i})),Array.isArray(e)&&e.map(r=>Ze(r,o))||Ze(e,o)):void 0;function Ze(e,o){if(e.fill=e.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(e.fillColor,e.fillOpacity)}),e.stroke=e.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(e.strokeColor,e.strokeOpacity),width:parseFloat(e.strokeWidth||1)}),e.image=e.icon&&lo(e.icon,o),e.image!==null)return e.text=e.label?.text&&new ol.style.Text({font:e.label.font||"12px sans-serif",text:String(e.label.text),overflow:e.label.overflow,stroke:e.label.strokeColor&&new ol.style.Stroke({color:e.label.strokeColor,width:e.label.strokeWidth||1}),fill:new ol.style.Fill({color:e.label.fillColor||"#000"})}),new ol.style.Style(e)}var te=new Map;function lo(e,o){Object.assign(e,o&&o.getProperties());let t=e.scale||1;return t*=e.clusterScale||1,t*=e.zoomInScale||1,t*=e.zoomOutScale||1,t*=e.highlightScale||1,delete e.scale,delete e.clusterScale,delete e.zoomInScale,delete e.zoomOutScale,delete e.highlightScale,te.has(e)?e.url=te.get(e):(e.url=e.url||e.svg||mapp.utils.svgSymbols[e.type](e,o),te.set(e,e.url)),new ol.style.Icon({src:e.url,scale:t,anchor:e.anchor||[.5,.5]})}var oe={};zt(oe,{circle:()=>wo,diamond:()=>fo,dot:()=>ao,markerColor:()=>go,markerLetter:()=>ho,semiCircle:()=>mo,square:()=>uo,target:()=>co,template:()=>yo,triangle:()=>po});var y=new XMLSerializer;function ao(e){let o=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function co(e){let o=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(m.node`<circle cx=12 cy=12 r=${parseFloat(t[0])*10} fill=${t[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function po(e){let o=m.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return o.appendChild(m.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(t=>{function r(s,l){return 12+(s-12)*l}function i(s,l){return 16+(s-16)*l}let n=`${r(12,t[0])},${i(4.68,t[0])} ${r(2,t[0])}, ${i(22,t[0])} ${r(22,t[0])}, ${i(22,t[0])}`;o.appendChild(m.node`
      <polygon
        points="${n}"
        fill=${t[1]}
        stroke=${t[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function uo(e){let o=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(m.node`
      <rect fill=${t[1]}
        width=${parseFloat(t[0])*20}
        height=${parseFloat(t[0])*20}
        x=${10*(1-parseFloat(t[0]))}
        y=${10*(1-parseFloat(t[0]))} rx=${parseFloat(t[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function fo(e){let o=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function t(r,i){return 12+(r-12)*i}return e.layers&&Object.entries(e.layers).forEach(r=>{let i=`${t(12,r[0])} ${t(0,r[0])},${t(24,r[0])} ${t(12,r[0])},${t(12,r[0])} ${t(24,r[0])}, ${t(0,r[0])} ${t(12,r[0])}`;o.appendChild(m.node`
      <polygon
        fill=${r[1]||"#FFF"}
        points="${i}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function mo(e){let o=m.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(t=>{o.appendChild(m.node`
      <circle cx=10 cy=10 r=${parseFloat(t[0])*10} fill=${t[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function ho(e){let o=m.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function go(e){let o=m.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function wo(e){let o=m.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`}function yo(e,o){let t=Object.assign({},e.params,o.getProperties()),r=e.template;for(let i of Object.entries(t))r=r.replaceAll(i[0],i[1]);return`data:image/svg+xml,${encodeURIComponent(r)}`}var qe=e=>{let o=e.getGeometry(),t=o.getCoordinates(),r=o.getType();if(!!t){if(r==="Point")return new ol.geom.Point(o.getCoordinates());if(r==="LineString")return new ol.geom.MultiPoint(o.getCoordinates());var i=r==="MultiPolygon"&&o.getCoordinates()[0]||o.getCoordinates(),n=new ol.geom.MultiPoint(i[0]);return n}};var re=new Map,Re=e=>new Promise((o,t)=>{if(!e)return t();if(e=typeof e=="string"?{url:e}:e,e.cache&&re.has(e))return o(re.get(e));let r=new XMLHttpRequest;r.open(e.method||"GET",e.url);let i={"Content-Type":"application/json"};Object.assign(i,e.requestHeader||{}),Object.entries(i).forEach(n=>r.setRequestHeader(...n)),r.responseType=e.responseType||"json",r.onload=n=>{if(n.target.status>=300){t(new Error(n.target.status));return}e.cache&&re.set(e,n.target.response),o(n.target.response)},r.send(e.body)});var xo=(e,o)=>e.size===o.size&&[...e].every(t=>o.has(t)),bo=(...e)=>o=>e.reduce((t,r)=>r(t),o),Ue={render:J,html:K,svg:m,areSetsEqual:xo,clone:N,compose:bo,copyToClipboard:$e,dataURLtoBlob:je,getCurrentPosition:Ge,here:Pe,hexa:Oe,loadPlugins:Ie,mapboxGeometryFunction:Ae,merge:F,paramString:_e,promiseAll:Ne,queryParams:Ve,style:Be,svgSymbols:oe,verticeGeoms:qe,xhr:Re};var h={current:{layers:[],locations:[]},set:So,parse:vo,remove:De,removeAll:ko,push:Mo,filter:Eo},V=h;function vo(){window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(e,o,t)=>{h.current[o]=decodeURI(t).split(",")}),h.current.token&&(window.history.replaceState({},document.title,window.location.href.replace(new RegExp(`token=${h.current.token}`),"")),delete h.current.token)}function So(e){Object.assign(h.current,e),T()}function De(e){Array.isArray(h.current[e])?h.current[e].length=0:delete h.current[e],T()}function ko(){Object.keys(h.current).forEach(e=>De(e)),T()}function Mo(e,o){h.current[e]?h.current[e].indexOf(o)<0&&h.current[e].push(o):h.current[e]=[o],T()}function Eo(e,o){h.current[e]=h.current[e].filter(t=>t!==o),T()}function T(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(h.current)}`)}catch(e){console.log(e)}}var He={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var We={save:"Speichern",cancel:"Abbrechen",invalid_geometry:"Ung\xFCltige Geometrie",confirm_delete:"Best\xE4tigung des L\xF6schvorgang"};var Je={save:"Enregister",cancel:"Annuler",no_results:"Aucun resultat pour cette recherche"};var Ke={save:"Zapisz",cancel:"Anuluj",no_results:"Nic nie znaleziono"};var Xe={save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",no_results:"\u7D50\u679C\u306A\u3057"};var Qe={save:"\uC800\uC7A5",cancel:"\uCDE8\uC18C",no_results:"\uAC80\uC0C9\uACB0\uACFC \uC5C6\uC74C"};var Ye={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",no_results:"\u672A\u627E\u5230\u76F8\u5173\u5730\u70B9"};var et={en:He,de:We,fr:Je,pl:Ke,ja:Xe,ko:Qe,zh:Ye};var ne,z=null;async function Co(){return z?new z.Map(...arguments):(ne||(ne=new Promise(async e=>{if(window.maplibregl){z=window.maplibregl,e();return}Promise.all([import("https://cdn.skypack.dev/pin/maplibre-gl@v1.15.3-OFxGDsJNZ70P0Qa7CzNE/mode=imports,min/optimized/maplibre-gl.js")]).then(o=>{z=o[0],e()}).catch(o=>{console.error(o.message),alert("Failed to load MaplibreGL library. Please reload the browser.")})})),await ne,new z.Map(...arguments))}var tt=async e=>{let o=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=await Co({container:o,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:t=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(t.viewState.center),zoom:t.viewState.zoom-1,bearing:-t.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var ie,P=null;async function Lo(){return P?new P.Map(...arguments):(ie||(ie=new Promise(async e=>{if(window.mapboxgl){P=window.mapboxgl,e();return}Promise.all([import("https://cdn.skypack.dev/pin/mapbox-gl@v2.8.2-2X0QssQ9YYqMIe57RkqH/mode=imports,min/optimized/mapbox-gl.js")]).then(o=>{P=o[0],e()}).catch(o=>{console.error(o.message),alert("Failed to load MapboxGL library. Please reload the browser.")})})),await ie,new P.Map(...arguments))}var ot=async e=>{let o=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=await Lo({accessToken:e.accessToken,container:o,style:e.mbStyle}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:t=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(t.viewState.center),zoom:t.viewState.zoom-1,bearing:-t.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var rt=e=>{let o=e.proxy&&`${e.mapview.host}/api/proxy?url=${e.URI}`||e.URI,t=new ol.source.OSM({url:decodeURIComponent(o),opaque:!1,transition:0});e.L=new ol.layer.Tile({source:t,layer:e,zIndex:e.style.zIndex||0})};var nt=e=>{e.reload=()=>{o.refresh()},e.snapSource=new ol.source.VectorTile({format:new ol.format.MVT({featureClass:ol.Feature}),transition:0,cacheSize:0,tileUrlFunction:t});let o=new ol.source.VectorTile({format:new ol.format.MVT,transition:0,cacheSize:0,tileUrlFunction:t});function t(r){let i=e.tableCurrent();return i?`${e.mapview.host}/api/layer/mvt/${r[0]}/${r[1]}/${r[2]}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:i,filter:e.filter&&e.filter.current}):o.clear()}e.L=new ol.layer.VectorTile({key:e.key,source:o,renderBuffer:200,zIndex:e.style.zIndex||1,style:mapp.layer.Style(e)})};var it=e=>{e.highlight=!0,e.reload=o;function o(){if(!e.display)return;e.xhr&&e.xhr.abort();let t=e.tableCurrent();if(!t){e.L.getSource().clear();return}let r=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/cluster/${e.mapview.Map.getView().getZoom()}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:t,kmeans:e.cluster_kmeans||void 0,dbscan:e.cluster_dbscan||void 0,resolution:e.cluster_resolution||void 0,hexgrid:e.cluster_hexgrid,theme:e.style.theme?.type,size:e.style.theme?.size,cat:e.style.theme?.fieldfx||e.style.theme?.field,aggregate:e.style.theme?.aggregate,label:e.style.label?.field,label_template:e.style.label?.template,filter:e.filter?.current,viewport:[r[0],r[1],r[2],r[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let n=i.target.response;e.max_size=n.reduce((c,u)=>Math.max(c,u.properties.size||u.properties.count),0);let s=1,l=n.map(c=>new ol.Feature(Object.assign({id:s++,geometry:new ol.geom.Point(e.srid==4326&&ol.proj.fromLonLat([c.geometry.x,c.geometry.y])||[c.geometry.x,c.geometry.y])},c.properties)));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:l}))},e.xhr.send()}e.L=new ol.layer.Vector({key:e.key,layer:e,zIndex:e.style.zIndex||10,style:mapp.layer.Style(e)}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",o)};var $o=new ol.format.GeoJSON,st=e=>{e.reload=o;function o(){mapp.utils.xhr(`${e.mapview.host}/api/layer/geojson?${mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:e.table,filter:e.filter&&e.filter.current})}`).then(t=>{let r=t.map(s=>new ol.Feature({id:s.id,geometry:$o.readGeometry(s.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:s.properties})),i=new ol.source.Vector({features:r}),n=e.type==="cluster"&&new ol.source.Cluster({distance:e.cluster_distance,source:i});e.L.setSource(n||i)})}e.L=new ol.layer.Vector({key:e.key,zIndex:e.style.zIndex||1,style:e.styleFunction||mapp.layer.Style(e)})};var lt=e=>{e.grid_size=Object.values(e.grid_fields)[0],e.grid_color=Object.values(e.grid_fields)[1],e.grid_ratio=!1,e.reload=o;function o(){if(!e.display)return;e.xhr&&e.xhr.abort();let t=e.tableCurrent();if(!t){e.L.getSource().clear();return}let r=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/grid?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:t,size:e.grid_size,color:e.grid_color,viewport:[r[0],r[1],r[2],r[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let n=i.target.response;e.sizeAvg=0,e.colorAvg=0;let s=n.map(a=>{if(parseFloat(a[2])>0)return a[2]=isNaN(a[2])?a[2]:parseFloat(a[2]),a[3]=isNaN(a[3])?a[3]:parseFloat(a[3]),e.grid_ratio&&a[3]>0&&(a[3]/=a[2]),e.sizeAvg+=parseFloat(a[2]),e.colorAvg+=isNaN(a[3])?0:parseFloat(a[3]),new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([a[0],a[1]])),properties:{size:parseFloat(a[2]),color:isNaN(a[3])?a[3]:parseFloat(a[3])}})});function l(a,p,d){let w=a.filter(g=>isFinite(g[p]));return Math[d].apply(null,w.map(g=>g[p]))}e.sizeMin=l(n,2,"min"),e.sizeAvg/=s.length,e.sizeMax=l(n,2,"max"),e.colorMin=l(n,3,"min"),e.colorAvg/=s.length,e.colorMax=l(n,3,"max"),e.colorBins=[];let c=e.style.range.length;for(var u=1;u<c;u++)u<c/2&&e.colorBins.push(e.colorMin+(e.colorAvg-e.colorMin)/(c/2)*u),u===c/2&&e.colorBins.push(e.colorAvg),u>c/2&&e.colorBins.push(e.colorAvg+(e.colorMax-e.colorAvg)/(c/2)*(u-c/2));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:s})),e.style.legend?.dispatchEvent(new Event("update"))},e.xhr.send()}e.L=new ol.layer.Vector({zIndex:e.style.zIndex||1,style:t=>{let r=t.getProperties().properties,i=r.size<=e.sizeAvg?7+7/e.sizeAvg*r.size:14+7/(e.sizeMax-e.sizeAvg)*(r.size-e.sizeAvg);if(r.hxcolor=e.style.hxcolor||"#C0C0C0",parseFloat(r.color)){r.hxcolor=e.style.range[0];for(let n=0;n<e.colorBins.length&&!(r.color<e.colorBins[n]);n++)r.hxcolor=e.style.range[n+1]}return mapp.utils.style({icon:{type:"dot",fillColor:r.hxcolor,scale:i/30}})}}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",o)};var se,at=async e=>{se||(se=new Promise(async i=>{await new google.maps.plugins.loader.Loader({apiKey:e.apiKey,version:"weekly"}).load(),i()})),await se;let o=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%; transition: opacity .25s ease-in-out;">`;e.gmap=new google.maps.Map(o,{disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});let t,r;e.L=new ol.layer.Layer({zIndex:0,render:i=>{if(!!e.display){r!==i.viewState.zoom&&(o.style.opacity=0),r=i.viewState.zoom;var n=ol.proj.toLonLat(i.viewState.center);return e.gmap.setCenter({lat:n[1],lng:n[0]}),e.gmap.setZoom(i.viewState.zoom),t&&clearTimeout(t),t=setTimeout(()=>{o.style.opacity=1},400),o}}})};var le={mbtiles:tt,mapboxgl:ot,tiles:rt,mvt:nt,cluster:it,geojson:st,grid:lt,googlemaps:at};var ct=async e=>(le[e.format]&&await le[e.format](e),Object.assign(e,{show:jo,showCallbacks:[],hide:Fo,hideCallbacks:[],tableCurrent:To,tableMax:zo,tableMin:Po,zoomToExtent:Oo}),e.filter=Object.assign({current:{}},e.filter),e.style&&e.style.themes&&(e.style.theme=e.style.theme||e.style.themes[Object.keys(e.style.themes)[0]]),Object.keys(e).forEach(o=>{mapp.layer[o]&&mapp.layer[o](e),mapp.plugins[o]&&mapp.plugins[o](e)}),e);function jo(){this.display=!0,this.mapview.Map.removeLayer(this.L),this.mapview.Map.addLayer(this.L),typeof this.reload=="function"&&this.reload(),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.push("layers",this.key),this.showCallbacks?.forEach(e=>typeof e=="function"&&e(this))}function Fo(){this.display=!1,this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.filter("layers",this.key),this.hideCallbacks?.forEach(e=>typeof e=="function"&&e(this))}function To(){if(!this.tables)return this.table;let e,o=parseInt(this.mapview.Map.getView().getZoom()),t=Object.keys(this.tables),r=parseInt(t[0]),i=parseInt(t[t.length-1]);return e=this.tables[o],e=o<r?this.tables[r]:e,e=o>i?this.tables[i]:e,e}function zo(){return this.tables?Object.values(this.tables).reverse().find(e=>!!e):this.table}function Po(){return this.tables?Object.values(layer.tables).find(e=>!!e):this.table}async function Oo(){let e=await mapp.utils.xhr(`${this.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:this.dbs,locale:this.mapview.locale.key,layer:this.key,table:this.table||Object.values(this.tables)[0]||Object.values(this.tables)[1],geom:this.geom,proj:this.srid,srid:this.mapview.srid,filter:this.filter.current})),o=/\((.*?)\)/.exec(e.box2d)[1].replace(/ /g,",");this.mapview.fitView(o.split(",").map(t=>parseFloat(t)),params)}var pt=e=>{e.hover.show=o=>{let t=e.mapview.interaction.current.key.toString(),r=mapp.utils.paramString({dbs:e.dbs,locale:e.mapview.locale.key,layer:e.key,template:e.hover.query||"infotip",qID:e.qID,id:e.highlight,table:e.tableCurrent(),geom:e.geom,field:e.hover.field,coords:e.format==="cluster"&&ol.proj.transform(o.getGeometry().getCoordinates(),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`)});mapp.utils.xhr(`${e.mapview.host}/api/query?${r}`).then(i=>{e.mapview.interaction?.current?.key===t&&(!e.mapview.position||!i||i.label!=""&&e.mapview.infotip(i.label))})}};var ut=e=>o=>{let t=o.getProperties();if(e.type==="cluster"&&(t.count=o.get("features").length),e.featureLookup){let a=e.featureLookup.find(p=>p.id===t.id);if(!a)return;Object.assign(t,a)}let r=Object.assign({},e.style.default,t.count&&t.count>1&&e.style.cluster||{},e.style.theme?.style||{});Object.assign(r,{label:e.style.label||null});let i=o.getGeometry().getType();if(i==="Point"){if(typeof r.icon=="function")return r.icon(o);r.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),r.icon=Object.assign({},r.icon||mapp.utils.clone(r))}else delete r.icon;delete r.scale,delete r.clusterScale;let n=e.style.theme;if(n&&n.type==="categorized"){var s=t.cat||t[n.field],l=n.cat&&(n.cat[s]?.style||n.cat[s]);if(s&&typeof l>"u"){var c=Object.values(n.cat).filter(p=>Array.isArray(p.keys)).find(p=>p.keys.includes(s)),l=mapp.utils.clone(c?.style||c);l&&delete l.label}typeof l<"u"&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(r,l))}if(n&&n.type==="graduated"){var s=parseFloat(t.cat||t[n.field]);if(!isNaN(s)){for(let p=0;p<n.cat_arr.length&&!(s<parseFloat(n.cat_arr[p].value));p++){var l=mapp.utils.clone(n.cat_arr[p].style||n.cat_arr[p]);delete l.label}l&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(r,l))}}r.icon?.clusterScale&&(r.icon.clusterScale=e.style.logScale?Math.log(r.icon.clusterScale)/Math.log(e.max_size)*Math.log(t.size||t.count):1+r.icon.clusterScale/e.max_size*(t.size||t.count)),r.icon?.zoomInScale&&(r.icon.zoomInScale*=e.mapview.Map.getView().getZoom()),r.icon?.zoomOutScale&&(r.icon.zoomOutScale/=e.mapview.Map.getView().getZoom());let u=o.get("id")||o.getId();if(e.highlight&&e.highlight===u){let a=mapp.utils.clone(e.style.highlight);i==="Point"?(a.icon=a.icon||a.marker||mapp.utils.clone(a),a.icon.highlightScale=a.icon.scale||1,delete a.icon.scale,delete a.scale):delete a.icon,mapp.utils.merge(r,a)}if(r.label&&(r.label.text=t.label||r.label.count&&t.count>1&&t.count,!r.label?.display&&delete r.label,r.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete r.label,r.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete r.label),!(e.mapview?.locations[`${e.key}!${t.id}`]&&(e.style.selected&&mapp.utils.merge(r,e.style.selected,{zIndex:1/0}),e.style.selected===null)))return mapp.utils.style(r,o)};var dt={decorate:ct,hover:pt,Style:ut};var ft=e=>(Object.assign(e,{flyTo:Go,Layers:[],remove:Io,removeCallbacks:[],trash:_o,update:Ao,updateCallbacks:[]}),e);function Io(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.format==="mvt"?this.layer.L.changed():this.layer.reload&&this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function Ao(){let e={};if(this.infoj.filter(t=>typeof t.newValue<"u").forEach(t=>{t.type==="integer"&&(t.newValue=isNaN(parseInt(t.newValue))?null:t.newValue),t.type==="numeric"&&(t.newValue=isNaN(parseFloat(t.newValue))?null:t.newValue),Object.assign(e,{[t.field]:t.newValue})}),!Object.keys(e).length)return;await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/location/update?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)});let o=this.infoj.filter(t=>typeof t.newValue<"u").filter(t=>t.dependents&&t.dependents.length).map(t=>t.dependents).flat();if(this.infoj.filter(t=>typeof t.newValue<"u").forEach(t=>{t.value=t.newValue,delete t.newValue}),o.length){let t=await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:[...new Set(o)].join()}));this.infoj.filter(r=>typeof t[r.field]<"u").forEach(r=>{r.value=t[r.field]})}this.layer.reload(),this.updateCallbacks?.forEach(t=>typeof t=="function"&&t(this))}function Go(){let e=new ol.source.Vector;this.Layers.forEach(o=>{let t=o.getSource();typeof t.getFeatures=="function"&&e.addFeatures(t.getFeatures())}),this.layer.mapview.fitView(e.getExtent())}async function _o(){!confirm(mapp.dictionary.confirm_delete)||(await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/delete?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.layer.reload(),this.remove())}async function mt(e,o=e.layer.mapview.locations){if(!e.layer||!e.id||(e.hook=`${e.layer.key}!${e.id}`,e.layer.mapview.interaction?.locations?.has(e.hook)))return;if(e.layer.mapview.interaction?.locations?.add(e.hook),o[e.hook]){o[e.hook].remove(),delete o[e.hook],e.layer.mapview.interaction?.locations?.delete(e.hook);return}e.table=e.table||e.layer.table||Object.values(e.layer.tables).find(i=>!!i);let t=await mapp.utils.xhr(`${e.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.table,id:e.id})),r=e.layer.infoj.map(i=>{let n=mapp.utils.clone(i);return Object.assign(n,{title:t[n.field+"_label"]||n.title,value:t[n.field],location:e}),n});return mapp.location.decorate(Object.assign(e,{infoj:r})),o[e.hook]=e,e.layer.mapview.interaction?.locations?.delete(e.hook),e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}async function ht(e){let o=e.feature.getProperties(),t=e.feature.getGeometry(),r=t.getCoordinates(),i=ol.proj.transform(r,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),n=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,cluster_label:e.layer.cluster_label||e.layer.qID,table:e.table,n:o.count>(e.max||99)?e.max||99:o.count,x:i[0],y:i[1],coords:i})),s=mapp.utils.html.node`
    <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
      <ul>
      ${n.map(l=>mapp.utils.html.node`
        <li
          onclick=${c=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:l.id,marker:ol.proj.transform(l.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${l.label||'"'+e.layer.cluster_label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(i,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:s,autoPan:!0})}var gt={decorate:ft,get:mt,nnearest:ht};async function wt(e){if(!Array.isArray(e))return;let o=this.hooks&&mapp.hooks.current.layers.length;for(let t of e){let r=mapp.utils.clone(t);r.mapview=this,o&&(r.display=!!~mapp.hooks.current.layers.indexOf(r.key)),await mapp.layer.decorate(r),this.layers[r.key]=r,r.display&&r.show()}return e}function yt(e,o={}){this.Map.getView().fit(e,Object.assign({padding:[50,50,50,50],duration:1e3},o))}function xt(e){let o=this.Map.getView().calculateExtent();if(!e)return{south:o[1],west:o[0],north:o[3],east:o[2]};let t=ol.proj.transformExtent(o,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:t[1],west:t[0],north:t[3],east:t[2]}}var No=new ol.format.GeoJSON;function bt(e){let o=e.geometry&&No.readFeature({type:"Feature",geometry:e.geometry},{dataProjection:`EPSG:${e.dataProjection||this.srid}`,featureProjection:`EPSG:${this.srid}`}),t=new ol.source.Vector;o&&t.addFeature(o);let r=new ol.layer.Vector({source:t,zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(r),r}var x={};function vt(e){let o=this;if(x.node?.remove(),o.Map.un("pointermove",t),!e)return;x.node=mapp.utils.html.node`<div class="infotip box-shadow">`,x.node.innerHTML=e,o.Map.getTargetElement().appendChild(x.node),o.Map.on("pointermove",t),t();function t(){x.node.style.opacity=1,x.node.style.left=o.pointerLocation.x-x.node.offsetWidth/2+"px",x.node.style.top=o.pointerLocation.y-x.node.offsetHeight-15+"px"}}function St(e){if(this._locate=this._locate||Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e||{}),this._locate.active=!this._locate.active,this._locate.L||(this._locate.L=new ol.layer.Vector({source:new ol.source.Vector({features:[this._locate.feature]}),zIndex:999,style:mapp.utils.style({icon:this._locate.icon})})),!this._locate.active){this.Map.removeLayer(this._locate.L);return}this.Map.addLayer(this._locate.L),mapp.utils.getCurrentPosition(o=>{let t=ol.proj.fromLonLat([parseFloat(o.coords.longitude),parseFloat(o.coords.latitude)]);this._locate.feature.getGeometry().setCoordinates(t),this.Map.getView().animate({center:t,zoom:this.locale.maxZoom})})}var v={};function kt(e){let o=this;v.node?.remove(),e&&(v.node=mapp.utils.html.node`<div class="popup box-shadow">`,v.node.appendChild(e.content),v.overlay&&o.Map.removeOverlay(v.overlay),v.overlay=new ol.Overlay({element:v.node,position:e.coords||o.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),o.Map.addOverlay(v.overlay))}var O,ae,E,I,ce;function Et(e){if(e===null){this.Map.removeInteraction(ce),E&&E.un("tileloadend",Mt),I&&this.Map.removeLayer(I),I=null,this.Map.removeLayer(ae);return}!e.snapSource&&!e.snapLayer||(O=e.snapSource||new ol.source.Vector,ae=new ol.layer.Vector({source:O,opacity:0}),this.Map.addLayer(ae),e.snapLayer?.snapSource?(E=e.snapLayer.snapSource,E.on("tileloadend",Mt),I=new ol.layer.VectorTile({source:E,opacity:0}),this.Map.addLayer(I),E.refresh()):e.snapLayer&&(O=e.snapLayer.L.getSource()),ce=new ol.interaction.Snap({source:O}),this.Map.addInteraction(ce))}function Mt(e){O.addFeatures(e.tile.getFeatures())}function Ct(e){let o=this;o.interaction?.finish();let t=Object.assign({type:"highlight",finish:r,clear:u,highlight:s,getLocation:a,hitTolerance:5,candidates:{},candidateKeys:new Set,locations:new Set,layerFilter:p=>Object.values(o.layers).some(d=>d.qID&&d.L===p)},e);o.interaction=t,o.Map.on("pointermove",n),o.Map.on("click",c),o.Map.getTargetElement().style.cursor="auto";function r(){delete o.interaction,o.Map.un("pointermove",n),o.Map.un("click",c)}let i;function n(p){if(i)return;i=!0;let d={};if(o.Map.forEachFeatureAtPixel(p.pixel,(g,Z)=>{let pe={key:`${Z.get("key")||ol.util.getUid(Z)}!${g.get("id")||g.getId()||ol.util.getUid(g)}`,F:g,L:Z};d[pe.key]=pe},{layerFilter:t.layerFilter,hitTolerance:t.hitTolerance}),!Object.keys(d).length){t.candidateKeys=new Set,i=!1,u();return}if(mapp.utils.areSetsEqual(t.candidateKeys,new Set(Object.keys(d)))){i=!1;return}let w=d[Object.keys(d).find(g=>!t.candidateKeys.has(g))];w=w||t.current?.key&&d[t.current?.key]||d[Object.keys(d)[0]],t.candidateKeys=new Set(Object.keys(d)),i=!1,t.highlight(w,p)}function s(p,d){if(u(),t.current=Object.assign(p,{layer:o.layers[p.L.get("key")],id:p.F.get("id")||p.F.getId()}),t.current.layer.highlight=p.id,d.originalEvent.pointerType!=="mouse"){d.type!=="pointermove"&&t.getLocation(t.current),u();return}t.current.layer.infoj&&(o.Map.getTargetElement().style.cursor="pointer"),typeof t.current.layer.hover?.show=="function"&&t.current.layer.hover.show(p.F),t.current.layer.format!=="mvt"&&typeof t.current.F.setStyle=="function"?(p.F.set("highlight",!0),t.current.F.setStyle()):t.current.layer.style.highlight&&t.current.layer.L.changed()}let l;function c(p){if(!l){if(l=setTimeout(()=>{l=null},600),p.originalEvent.pointerType==="touch"){t.candidateKeys=new Set,p.type="touchClick",n(p);return}o.popup(null),t.current&&t.getLocation(t.current)}}function u(){!t.current||(o.infotip(null),o.Map.getTargetElement().style.cursor="auto",delete t.current.layer.highlight,t.current.layer.format!=="mvt"&&typeof t.current.F.setStyle=="function"?(t.current.F.set("highlight",!1),t.current.F.setStyle()):t.current.layer.style.highlight&&t.current.layer.L.changed(),delete t.current)}function a(p){if(p.F.getProperties().count>1){mapp.location.nnearest({mapview:o,layer:p.layer,table:p.layer.table||p.layer.tableCurrent(),feature:p.F});return}mapp.location.get({layer:p.layer,table:p.layer.table||p.layer.tableCurrent(),id:p.layer.highlight})}}function Lt(e){let o=this;o.interaction?.finish();let t=Object.assign({type:"draw",finish:n,format:new ol.format.GeoJSON,Layer:new ol.layer.Vector({source:new ol.source.Vector}),contextMenu:mapp.ui?.elements.contextMenu.draw.bind(o),metricFunction:r,vertices:[],srid:o.srid,getFeature:i,style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);o.Map.getTargetElement().style.cursor="crosshair",o.Map.addLayer(t.Layer),t.interaction=new ol.interaction.Draw({source:t.Layer.getSource(),geometryFunction:t.geometryFunction,freehand:t.freehand,type:t.type,style:t.style,condition:s=>{if(t.kinks)return!1;if(s.originalEvent.buttons===1)return t.vertices.push(s.coordinate),o.popup(null),typeof t.condition=="function"&&t.condition(s),!0}}),t.interaction.on("drawstart",s=>{t.tooltip&&t.metricFunction(s.feature.getGeometry(),t.tooltip),s.feature.setStyle(t.style),t.Layer.getSource().clear(),o.popup(null)}),t.interaction.on("drawend",s=>{if(t.drawend)return t.drawend(s);typeof t.contextMenu=="function"&&setTimeout(t.contextMenu,400)}),o.interaction=t,o.Map.addInteraction(t.interaction),o.snapSource(t),typeof t.contextMenu=="function"&&o.Map.getTargetElement().addEventListener("contextmenu",t.contextMenu);function r(s,l){let c={distance:()=>ol.sphere.getLength(new ol.geom.LineString([s.getInteriorPoint().getCoordinates(),_xyz.mapview.position])),area:()=>ol.sphere.getArea(s),length:()=>ol.sphere.getLength(s)};!c[l]||s.on("change",()=>{o.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">${parseInt(c[l]()).toLocaleString("en-GB")+(l==="area"?"sqm":"m")}`})})}function i(){let s=t.Layer.getSource().getFeatures();return JSON.parse(t.format.writeFeature(s[0],{dataProjection:"EPSG:"+t.srid,featureProjection:"EPSG:"+o.srid}))}function n(s){delete o.interaction,t.callback&&t.callback(s),o.popup(null),typeof t.contextMenu=="function"&&o.Map.getTargetElement().removeEventListener("contextmenu",t.contextMenu),o.snapSource(null),o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Layer.getSource().clear(),o.Map.getTargetElement().style.cursor="default"}}function $t(e){let o=this;o.interaction?.finish();let t=Object.assign({type:"modify",finish:i,format:new ol.format.GeoJSON,Source:new ol.source.Vector,vertices:[],srid:o.srid,contextMenu:mapp.ui?.elements.contextMenu.modify.bind(o),getFeature:r,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);o.Map.getTargetElement().style.cursor="crosshair",t.Feature&&t.Source.addFeature(t.Feature),t.Layer=new ol.layer.Vector({source:t.Source,zIndex:9999,style:t.Style}),o.Map.addLayer(t.Layer),t.interaction=new ol.interaction.Modify({source:t.Source,deleteCondition:n=>{if(n.type==="singleclick"){let s=t.Feature.getGeometry(),l=s.getType();if(l==="Point")return;let c=s.getCoordinates();if(l==="LineString"&&c.length<3||c[0].length<=4)return;o.popup({coords:t.Feature.getGeometry().getClosestPoint(n.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{t.interaction.removePoint(),t.vertices.push(t.Feature.getGeometry().getClosestPoint(n.coordinate))}}>${mapp.dictionary.delete_vertex}`})}}}),t.interaction.on("modifystart",n=>{o.popup(null)}),t.interaction.on("modifyend",n=>{if(t.vertices.push(n.mapBrowserEvent.coordinate),t.modifyend)return t.modifyend(n,t);typeof t.contextMenu=="function"&&setTimeout(t.contextMenu,400)}),o.interaction=t,o.Map.addInteraction(t.interaction),o.snapSource(t);function r(){return JSON.parse(t.format.writeFeature(t.Feature,{dataProjection:"EPSG:"+t.srid,featureProjection:"EPSG:"+o.srid}))}function i(n){delete o.interaction,t.callback&&t.callback(n),o.popup(null),o.snapSource(null),o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Source.clear(),o.Map.getTargetElement().style.cursor="default"}}function jt(e){let o=this;o.interaction?.finish();let t={finish:r,Layer:new ol.layer.Vector({source:new ol.source.Vector})};o.interaction=t,t.callback=e.callback,t.Layer.getSource().clear(),o.Map.addLayer(t.Layer),o.Map.getTargetElement().style.cursor="zoom-in",t.interaction=new ol.interaction.Draw({source:t.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ddd",width:1}),fill:new ol.style.Stroke({color:"#fff9"})})}),t.interaction.on("drawend",i=>{o.fitView(i.feature.getGeometry().getExtent()),r()}),o.Map.addInteraction(t.interaction);function r(){delete o.interaction,t.callback&&(t.callback(),delete t.callback),o.Map.getTargetElement().style.cursor="auto",o.Map.removeInteraction(t.interaction),o.Map.removeLayer(t.Layer),t.Layer.getSource().clear()}}var Ft=e=>{Object.assign(e,{srid:e.locale.srid||"3857",addLayer:wt,fitView:yt,geoJSON:bt,getBounds:xt,infotip:vt,locate:St,popup:kt,snapSource:Et,layers:{},locations:{},interactions:{highlight:Ct.bind(e),draw:Lt.bind(e),modify:$t.bind(e),zoom:jt.bind(e)}});let o=mapp.hooks?.current?.z||e.locale.view?.z||e.locale.minZoom||0,t=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.locale.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.locale.view?.lat||0)]);e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent");let r=e.locale.extent&&ol.proj.transformExtent([parseFloat(e.locale.extent.west||-180),parseFloat(e.locale.extent.south||-90),parseFloat(e.locale.extent.east||180),parseFloat(e.locale.extent.north||90)],"EPSG:4326",`EPSG:${e.srid}`);e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults({mouseWheelZoom:e.scrollWheelZoom||!1,pinchRotate:{threshold:3}}),moveTolerance:5,controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:o,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:t,extent:r})});let i;if(new ResizeObserver(()=>{i&&clearTimeout(i),i=setTimeout(()=>{e.Map.updateSize()},1e3)}).observe(e.Map.getTargetElement()),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let s=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],l=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],c=new ol.Feature({geometry:new ol.geom.Polygon([s,l]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[c]}),style:new ol.style.Style({fill:new ol.style.Fill({color:"#00000044"})}),zIndex:1/0}))}e.scalebar&&e.Map.addControl(new ol.control.ScaleLine({units:e.scalebar})),e.attribution&&(typeof e.attribution!="object"&&(e.attribution={}),e.attribution.target=e.attribution.target||e.Map.getTargetElement().appendChild(mapp.utils.html.node`
          <div class="attribution-links">`),e.attribution.check=()=>{let s=Object.assign({},e.attribution.links||{});Object.values(e.layers).forEach(l=>{l.display&&l.attribution&&Object.assign(s,l.attribution)}),mapp.utils.render(e.attribution.target,mapp.utils.html`${Object.entries(s).map(l=>mapp.utils.html`
              <a class="background-fade" target="_blank" href="${l[1]}">${l[0]}`)}`)}),e.Map.on("pointermove",s=>{e.position=s.coordinate,e.pointerLocation={x:s.originalEvent.clientX,y:s.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.infotip(null),e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.hooks)return;let s=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:Math.round((s[1]+Number.EPSILON)*1e5)/1e5,lng:Math.round((s[0]+Number.EPSILON)*1e5)/1e5,z:Math.round((e.Map.getView().getZoom()+Number.EPSILON)*100)/100})});let n;return e.Map.on("moveend",()=>{clearTimeout(n),n=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),e};V.parse();var k={version:"4.\u03B2",hash:"c85386246d221638769d54dc779419b19769d5b0",language:V.current.language||"en",dictionaries:et,dictionary:new Proxy({},{get:function(e,o,t){return k.dictionaries[k.language][o]?k.dictionaries[k.language][o]:k.dictionaries.en[o]}}),hooks:V,layer:dt,location:gt,Mapview:Ft,plugins:{},utils:Ue};window.mapp=k;var Mi=k;export{Mi as default};
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=mapp.js.map
