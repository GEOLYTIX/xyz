var Ct=Object.defineProperty;var Lt=(e,t)=>{for(var o in t)Ct(e,o,{get:t[o],enumerable:!0})};var z=class extends Map{set(t,o){return super.set(t,o),o}},S=class extends WeakMap{set(t,o){return super.set(t,o),o}};var $t=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Ft=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,jt=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,Tt=/[\x01\x02]/g,ce=(e,t,o)=>{let r=0;return e.join("").trim().replace(Ft,(i,n,s,l)=>{let p=n+s.replace(jt,"=$2$1").trimEnd();return l.length&&(p+=o||$t.test(n)?" /":"></"+n),"<"+p+">"}).replace(Tt,i=>i===""?"<!--"+t+r+++"-->":t+r++)};var Po=1,zo=111,Ot=({firstChild:e,lastChild:t})=>{let o=document.createRange();return o.setStartAfter(e),o.setEndAfter(t),o.deleteContents(),e},pe=(e,t)=>e.nodeType===111?1/t<0?t?Ot(e):e.lastChild:t?e.valueOf():e.firstChild:e,ue=e=>{let{firstChild:t,lastChild:o}=e;if(t===o)return o||e;let{childNodes:r}=e,i=[...r];return{ELEMENT_NODE:1,nodeType:111,firstChild:t,lastChild:o,valueOf(){return r.length!==i.length&&e.append(...i),e}}};var{isArray:N}=Array,{indexOf:Pt,slice:zt}=[];var de=!1,I=class{constructor(t,o){de=!0,this._=(...r)=>t(...r,o)}},Go=(e,t)=>new I(e,t),fe=e=>t=>{for(let o in t){let r=o==="role"?o:`aria-${o}`,i=t[o];i==null?e.removeAttribute(r):e.setAttribute(r,i)}},me=(e,t)=>{let o,r=!0,i=document.createAttributeNS(null,t);return n=>{if(o!==n)if(o=n,o==null)r||(e.removeAttributeNode(i),r=!0);else{let s=de&&n instanceof I?n._(e,t):n;s==null?(r||e.removeAttributeNode(i),r=!0):(i.value=s,r&&(e.setAttributeNodeNS(i),r=!1))}}},he=(e,t,o)=>r=>{o!==!!r&&((o=!!r)?e.setAttribute(t,""):e.removeAttribute(t))},It=({dataset:e})=>t=>{for(let o in t){let r=t[o];r==null?delete e[o]:e[o]=r}},V=(e,t)=>{let o,r,i=t.slice(2);return!(t in e)&&(r=t.toLowerCase())in e&&(i=r.slice(2)),n=>{let s=N(n)?n:[n,!1];o!==s[0]&&(o&&e.removeEventListener(i,o,s[1]),(o=s[0])&&e.addEventListener(i,o,s[1]))}},ge=e=>{let t;return o=>{t!==o&&(t=o,typeof o=="function"?o(e):o.current=e)}},xe=(e,t)=>t==="dataset"?It(e):o=>{e[t]=o},we=e=>{let t;return o=>{t!=o&&(t=o,e.textContent=o??"")}};var ye=(e,t,o,r,i)=>{let n=o.length,s=t.length,l=n,p=0,a=0,c=null;for(;p<s||a<l;)if(s===p){let u=l<n?a?r(o[a-1],-0).nextSibling:r(o[l-a],0):i;for(;a<l;)e.insertBefore(r(o[a++],1),u)}else if(l===a)for(;p<s;)(!c||!c.has(t[p]))&&e.removeChild(r(t[p],-1)),p++;else if(t[p]===o[a])p++,a++;else if(t[s-1]===o[l-1])s--,l--;else if(t[p]===o[l-1]&&o[a]===t[s-1]){let u=r(t[--s],-1).nextSibling;e.insertBefore(r(o[a++],1),r(t[p++],-1).nextSibling),e.insertBefore(r(o[--l],1),u),t[s]=o[l]}else{if(!c){c=new Map;let u=a;for(;u<l;)c.set(o[u],u++)}if(c.has(t[p])){let u=c.get(t[p]);if(a<u&&u<l){let h=p,g=1;for(;++h<s&&h<l&&c.get(t[h])===u+g;)g++;if(g>u-a){let x=r(t[p],0);for(;a<u;)e.insertBefore(r(o[a++],1),x)}else e.replaceChild(r(o[a++],1),r(t[p++],-1))}else p++}else e.removeChild(r(t[p++],-1))}return o};var{isArray:C,prototype:At}=Array,{indexOf:B}=At,{createDocumentFragment:_t,createElement:Gt,createElementNS:Nt,createTextNode:R,createTreeWalker:Z,importNode:U}=new Proxy(document,{get:(e,t)=>e[t].bind(e)}),Vt=e=>{let t=Gt("template");return t.innerHTML=e,t.content},A,Bt=e=>{A||(A=Nt("http://www.w3.org/2000/svg","svg")),A.innerHTML=e;let t=_t();return t.append(...A.childNodes),t},be=(e,t)=>t?Bt(e):Vt(e);var Rt=({childNodes:e},t)=>e[t],L=(e,t,o)=>ye(e.parentNode,t,o,pe,e),Zt=e=>{let t,o,r=[],i=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,o||(o=R("")),o.data=n,r=L(e,r,[o]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,r=L(e,r,[]));break}if(C(n)){t=n,n.length===0?r=L(e,r,[]):typeof n[0]=="object"?r=L(e,r,n):i(String(n));break}t!==n&&"ELEMENT_NODE"in n&&(t=n,r=L(e,r,n.nodeType===11?[...n.childNodes]:[n]));break;case"function":i(n(e));break}};return i},Ut=(e,t)=>{switch(t[0]){case"?":return he(e,t.slice(1),!1);case".":return xe(e,t.slice(1));case"@":return V(e,"on"+t.slice(1));case"o":if(t[1]==="n")return V(e,t)}switch(t){case"ref":return ge(e);case"aria":return fe(e)}return me(e,t)};function ve(e){let{type:t,path:o}=e,r=o.reduceRight(Rt,this);return t==="node"?Zt(r):t==="attr"?Ut(r,e.name):we(r)}var D=e=>{let t=[],{parentNode:o}=e;for(;o;)t.push(B.call(o.childNodes,e)),e=o,{parentNode:o}=e;return t},$="is\xB5",Se=new S,Dt=/^(?:textarea|script|style|title|plaintext|xmp)$/,E=()=>({stack:[],entry:null,wire:null}),qt=(e,t)=>{let{content:o,updates:r}=Wt(e,t);return{type:e,template:t,content:o,updates:r,wire:null}},Ht=(e,t)=>{let o=e==="svg",r=ce(t,$,o),i=be(r,o),n=Z(i,129),s=[],l=t.length-1,p=0,a=`${$}${p}`;for(;p<l;){let c=n.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.data===a&&(s.push({type:"node",path:D(c)}),a=`${$}${++p}`);else{for(;c.hasAttribute(a);)s.push({type:"attr",path:D(c),name:c.getAttribute(a)}),c.removeAttribute(a),a=`${$}${++p}`;Dt.test(c.localName)&&c.textContent.trim()===`<!--${a}-->`&&(c.textContent="",s.push({type:"text",path:D(c)}),a=`${$}${++p}`)}}return{content:i,nodes:s}},Wt=(e,t)=>{let{content:o,nodes:r}=Se.get(t)||Se.set(t,Ht(e,t)),i=U(o,!0),n=r.map(ve,i);return{content:i,updates:n}},F=(e,{type:t,template:o,values:r})=>{let i=ke(e,r),{entry:n}=e;(!n||n.template!==o||n.type!==t)&&(e.entry=n=qt(t,o));let{content:s,updates:l,wire:p}=n;for(let a=0;a<i;a++)l[a](r[a]);return p||(n.wire=ue(s))},ke=({stack:e},t)=>{let{length:o}=t;for(let r=0;r<o;r++){let i=t[r];i instanceof b?t[r]=F(e[r]||(e[r]=E()),i):C(i)?ke(e[r]||(e[r]=E()),i):e[r]=null}return o<e.length&&e.splice(o),o},b=class{constructor(t,o,r){this.type=t,this.template=o,this.values=r}};var Ee=e=>{let t=new S,o=r=>(i,...n)=>F(r,{type:e,template:i,values:n});return Object.assign((r,...i)=>new b(e,r,i),{for(r,i){let n=t.get(r)||t.set(r,new z);return n.get(i)||n.set(i,o(E()))},node:(r,...i)=>F(E(),new b(e,r,i)).valueOf()})},Me=new S,q=(e,t)=>{let o=typeof t=="function"?t():t,r=Me.get(e)||Me.set(e,E()),i=o instanceof b?F(r,o):o;return i!==r.wire&&(r.wire=i,e.replaceChildren(i.valueOf())),e},H=Ee("html"),f=Ee("svg");function _(e,t=new WeakMap){if(e===null||typeof e!="object"||typeof e=="function"||e instanceof HTMLElement)return e;let o=Array.isArray(e)?[]:{};if(t.get(e))return t.get(e);t.set(e,o);for(let r in e)o[r]=_(e[r],t);return o}function Ce(e){let t=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);t.value=e,t.select(),document.execCommand("copy"),t.remove()}function Le(e){if(e.indexOf(";base64,")==-1){let n=e.split(","),s=n[0].split(":")[1],l=n[1];return new Blob([l],{type:s})}let t=e.split(";base64,"),o=t[0].split(":")[1],r=window.atob(t[1]),i=new Uint8Array(r.length);for(let n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return new Blob([i],{type:o})}var ir=5,$e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Jt=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Fe=1,Kt=0,sr=1,lr=2,ar=3,cr=6,pr=7,d=typeof BigInt<"u"?BigInt:Number;function je(e){let t=Qt(e),o=Yt(t[0],t[1]),r=10**o.precision,i=10**o.thirdDimPrecision,{thirdDim:n}=o,s=0,l=0,p=0,a=[],c=2;for(;c<t.length;){let u=W(t[c])/r,h=W(t[c+1])/r;s+=u,l+=h,n?(p+=W(t[c+2])/i,a.push([s,l,p]),c+=3):(a.push([s,l]),c+=2)}if(c!==t.length)throw new Error("Invalid encoding. Premature ending reached");return{...o,polyline:a}}function Xt(e){let t=e.charCodeAt(0);return Jt[t-45]}function Qt(e){let t=d(0),o=d(0),r=[];if(e.split("").forEach(i=>{let n=d(Xt(i));t|=(n&d(31))<<o,(n&d(32))===d(0)?(r.push(t),t=d(0),o=d(0)):o+=d(5)}),o>0)throw new Error("Invalid encoding");return r}function Yt(e,t){if(+e.toString()!==Fe)throw new Error("Invalid format version");let o=+t.toString(),r=o&15,i=o>>4&7,n=o>>7&15;return{precision:r,thirdDim:i,thirdDimPrecision:n}}function W(e){let t=e;return t&d(1)&&(t=~t),t>>=d(1),+t.toString()}function ur({precision:e=5,thirdDim:t=Kt,thirdDimPrecision:o=0,polyline:r}){let i=10**e,n=10**o,s=eo(e,t,o),l=[],p=d(0),a=d(0),c=d(0);return r.forEach(u=>{let h=d(Math.round(u[0]*i));l.push(K(h-p)),p=h;let g=d(Math.round(u[1]*i));if(l.push(K(g-a)),a=g,t){let x=d(Math.round(u[2]*n));l.push(K(x-c)),c=x}}),[...s,...l].join("")}function eo(e,t,o){if(e<0||e>15)throw new Error("precision out of range. Should be between 0 and 15");if(o<0||o>15)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(t<0||t>7||t===4||t===5)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");let r=o<<7|t<<4|e;return J(Fe)+J(r)}function J(e){let t="",o=d(e);for(;o>31;){let r=o&d(31)|d(32);t+=$e[r],o>>=d(5)}return t+$e[o]}function K(e){let t=d(e),o=t<0;return t<<=d(1),o&&(t=~t),J(t)}var Te={decodeIsoline:je,geometryFunction:to};function to(e,t,o){let r=new ol.geom.Circle(e,o.range*1e3),i=ol.proj.transform(e,`EPSG:${t.mapview.srid}`,"EPSG:4326"),n={"range[type]":o["range[type]"],"range[values]":o.range*60,transportMode:o.transportMode,optimizeFor:o.optimizeFor,origin:`${i[1]},${i[0]}`};return o.lat=i[1],o.lon=i[0],o.dateISO&&(n[o.reverseDirection&&"arrivalTime"||"departureTime"]=new Date(o.dateISO).toISOString()),mapp.utils.xhr(`${t.mapview.host}/api/proxy?url=${encodeURIComponent(`https://isoline.router.hereapi.com/v8/isolines?${mapp.utils.paramString(n)}&{HERE}`)}`).then(s=>{if(!s.isolines)return console.log(s),alert("Query failed.");let l=je(s.isolines[0].polygons[0].outer);l.polyline.forEach(a=>a.reverse()),l.polyline.push(l.polyline[0]);let p=t.mapview.interaction.format.readFeature({type:"Feature",geometry:{type:"Polygon",coordinates:[l.polyline]}},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+t.mapview.srid});t.mapview.interaction.Layer.getSource().clear(),t.mapview.interaction.Layer.getSource().addFeature(p)}),r}var Oe=(e,t)=>isNaN(t)?e:e.length===7?e+parseInt(t*255).toString(16):e.length===4?e+parseInt(t*15).toString(16):e;var Pe=e=>{if(!!Array.isArray(e))return new Promise(t=>{let o=e.map(r=>new Promise((i,n)=>import(r).then(s=>{i(s)}).catch(n)));Promise.all(o).then(r=>{t(r)}).catch(t)})};var ze=(e,t,o)=>{let r=new ol.geom.Circle(e,o.minutes*1e3),i=ol.proj.transform(e,`EPSG:${t.mapview.srid}`,"EPSG:4326");return mapp.utils.xhr(`https://api.mapbox.com/isochrone/v1/mapbox/${o.profile}/${i.join(",")}?${mapp.utils.paramString({contours_minutes:o.minutes,polygons:!0,access_token:o.access_token})}`).then(n=>{if(!n.features)return;let s=t.mapview.interaction.format.readFeature({type:"Feature",geometry:n.features[0].geometry},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+t.mapview.srid});t.mapview.interaction.Layer.getSource().clear(),t.mapview.interaction.Layer.getSource().addFeature(s)}),r};function Ie(e,t={}){navigator.geolocation.getCurrentPosition(e,o=>console.error(o),t)}function j(e,...t){if(!t.length)return e;let o=t.shift();if(X(e)&&X(o))for(let r in o)X(o[r])?(e[r]||Object.assign(e,{[r]:{}}),j(e[r],o[r])):Object.assign(e,{[r]:o[r]});return j(e,...t)}function X(e){return e&&typeof e=="object"&&!Array.isArray(e)}var Ae=e=>Object.entries(e).filter(t=>t[1]===0||!!t[1]).filter(t=>t[1]!=="{}").filter(t=>typeof t[1]!="object"||t[1].length||Object.values(t[1]).some(o=>typeof o=="object"&&Object.keys(o).length)).map(t=>(typeof t[1]=="object"&&!Array.isArray(t[1])&&(t[1]=JSON.stringify(t[1])),typeof t[1]=="string"&&(t[1]=encodeURIComponent(t[1])),Array.isArray(t[1])&&(t[1]=t[1].map(o=>encodeURIComponent(o))),encodeURI(`${t[0]}=${t[1]}`))).join("&");var _e=e=>new Promise((t,o)=>{Promise.all(e).then(t).catch(r=>{console.error(r),o(r)})});var Ne=(e,t)=>e?(Array.isArray(e.icon?.layers)&&(e=e.icon.layers.map(r=>{let i=mapp.utils.clone(e);return Object.assign(i.icon,r),i})),Array.isArray(e)&&e.map(r=>Ge(r,t))||Ge(e,t)):void 0;function Ge(e,t){if(e.fill=e.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(e.fillColor,e.fillOpacity)}),e.stroke=e.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(e.strokeColor,e.strokeOpacity),width:parseFloat(e.strokeWidth||1)}),e.image=e.icon&&oo(e.icon,t),e.image!==null)return e.text=e.label?.display&&e.label?.text&&new ol.style.Text({font:e.label.font||"12px sans-serif",text:String(e.label.text),overflow:e.label.overflow,stroke:e.label.strokeColor&&new ol.style.Stroke({color:e.label.strokeColor,width:e.label.strokeWidth||1}),fill:new ol.style.Fill({color:e.label.fillColor||"#000"})}),new ol.style.Style(e)}var Q=new Map;function oo(e,t){Object.assign(e,t&&t.getProperties());let o=e.scale||1;return o*=e.clusterScale||1,o*=e.zoomInScale||1,o*=e.zoomOutScale||1,o*=e.highlightScale||1,delete e.scale,delete e.clusterScale,delete e.zoomInScale,delete e.zoomOutScale,delete e.highlightScale,Q.has(e)?e.url=Q.get(e):(e.url=e.url||e.svg||mapp.utils.svgSymbols[e.type](e,t),Q.set(e,e.url)),new ol.style.Icon({src:e.url,scale:o,anchor:e.anchor||[.5,.5]})}var Y={};Lt(Y,{circle:()=>uo,diamond:()=>lo,dot:()=>ro,markerColor:()=>po,markerLetter:()=>co,semiCircle:()=>ao,square:()=>so,target:()=>no,template:()=>fo,triangle:()=>io});var w=new XMLSerializer;function ro(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function no(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`<circle cx=12 cy=12 r=${parseFloat(o[0])*10} fill=${o[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function io(e){let t=f.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return t.appendChild(f.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(o=>{function r(s,l){return 12+(s-12)*l}function i(s,l){return 16+(s-16)*l}let n=`${r(12,o[0])},${i(4.68,o[0])} ${r(2,o[0])}, ${i(22,o[0])} ${r(22,o[0])}, ${i(22,o[0])}`;t.appendChild(f.node`
      <polygon
        points="${n}"
        fill=${o[1]}
        stroke=${o[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function so(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`
      <rect fill=${o[1]}
        width=${parseFloat(o[0])*20}
        height=${parseFloat(o[0])*20}
        x=${10*(1-parseFloat(o[0]))}
        y=${10*(1-parseFloat(o[0]))} rx=${parseFloat(o[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function lo(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function o(r,i){return 12+(r-12)*i}return e.layers&&Object.entries(e.layers).forEach(r=>{let i=`${o(12,r[0])} ${o(0,r[0])},${o(24,r[0])} ${o(12,r[0])},${o(12,r[0])} ${o(24,r[0])}, ${o(0,r[0])} ${o(12,r[0])}`;t.appendChild(f.node`
      <polygon
        fill=${r[1]||"#FFF"}
        points="${i}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function ao(e){let t=f.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`
      <circle cx=10 cy=10 r=${parseFloat(o[0])*10} fill=${o[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function co(e){let t=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function po(e){let t=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function uo(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(w.serializeToString(t))}`}function fo(e,t){let o=Object.assign({},e.params,t.getProperties()),r=e.template;for(let i of Object.entries(o))r=r.replaceAll(i[0],i[1]);return`data:image/svg+xml,${encodeURIComponent(r)}`}var Ve=e=>{let t=e.getGeometry(),o=t.getCoordinates(),r=t.getType();if(!!o){if(r==="Point")return new ol.geom.Point(t.getCoordinates());if(r==="LineString")return new ol.geom.MultiPoint(t.getCoordinates());var i=r==="MultiPolygon"&&t.getCoordinates()[0]||t.getCoordinates(),n=new ol.geom.MultiPoint(i[0]);return n}};var ee=new Map,Be=e=>new Promise((t,o)=>{if(!e)return o();if(e=typeof e=="string"?{url:e}:e,e.cache&&ee.has(e))return t(ee.get(e));let r=new XMLHttpRequest;r.open(e.method||"GET",e.url);let i={"Content-Type":"application/json"};Object.assign(i,e.requestHeader||{}),Object.entries(i).forEach(n=>r.setRequestHeader(...n)),r.responseType=e.responseType||"json",r.onload=n=>{if(n.target.status>=300){o(new Error(n.target.status));return}e.cache&&ee.set(e,n.target.response),t(n.target.response)},r.send(e.body)});var mo=(e,t)=>e.size===t.size&&[...e].every(o=>t.has(o)),ho=(...e)=>t=>e.reduce((o,r)=>r(o),t),Re={render:q,html:H,svg:f,areSetsEqual:mo,clone:_,compose:ho,copyToClipboard:Ce,dataURLtoBlob:Le,getCurrentPosition:Ie,here:Te,hexa:Oe,loadPlugins:Pe,mapboxGeometryFunction:ze,merge:j,paramString:Ae,promiseAll:_e,style:Ne,svgSymbols:Y,verticeGeoms:Ve,xhr:Be};var m={current:{layers:[],locations:[]},set:xo,parse:go,remove:Ze,removeAll:wo,push:yo,filter:bo},G=m;function go(){window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(e,t,o)=>{m.current[t]?m.current[t]=decodeURI(o).split(","):m.current[t]=decodeURI(o)}),m.current.token&&(window.history.replaceState({},document.title,window.location.href.replace(new RegExp(`token=${m.current.token}`),"")),delete m.current.token)}function xo(e){Object.assign(m.current,e),T()}function Ze(e){Array.isArray(m.current[e])?m.current[e].length=0:delete m.current[e],T()}function wo(){Object.keys(m.current).forEach(e=>Ze(e)),T()}function yo(e,t){m.current[e]?m.current[e].indexOf(t)<0&&m.current[e].push(t):m.current[e]=[t],T()}function bo(e,t){m.current[e]=m.current[e].filter(o=>o!==t),T()}function T(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(m.current)}`)}catch(e){console.log(e)}}var Ue={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var De={save:"Speichern",cancel:"Abbrechen",invalid_geometry:"Ung\xFCltige Geometrie",confirm_delete:"Best\xE4tigung des L\xF6schvorgang"};var qe={save:"Enregister",cancel:"Annuler",no_results:"Aucun resultat pour cette recherche"};var He={save:"Zapisz",cancel:"Anuluj",no_results:"Nic nie znaleziono"};var We={save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",no_results:"\u7D50\u679C\u306A\u3057"};var Je={save:"\uC800\uC7A5",cancel:"\uCDE8\uC18C",no_results:"\uAC80\uC0C9\uACB0\uACFC \uC5C6\uC74C"};var Ke={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",no_results:"\u672A\u627E\u5230\u76F8\u5173\u5730\u70B9"};var Xe={en:Ue,de:De,fr:qe,pl:He,ja:We,ko:Je,zh:Ke};function te(){this.display=!0,this.view?.dispatchEvent(new Event("displayTrue")),this.mapview.Map.removeLayer(this.L),this.mapview.Map.addLayer(this.L),typeof this.reload=="function"&&this.reload(),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.push("layers",this.key)}function oe(){this.display=!1,this.view?.dispatchEvent(new Event("displayFalse")),this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.filter("layers",this.key)}function re(){if(!this.tables)return this.table;let e,t=parseInt(this.mapview.Map.getView().getZoom()),o=Object.keys(this.tables),r=parseInt(o[0]),i=parseInt(o[o.length-1]);return e=this.tables[t],e=t<r?this.tables[r]:e,e=t>i?this.tables[i]:e,e}function ne(){return this.tables?Object.values(this.tables).reverse().find(e=>!!e):this.table}function ie(){return this.tables?Object.values(layer.tables).find(e=>!!e):this.table}function Qe(e){return mapp.layer.format[e.format]&&mapp.layer.format[e.format](e),Object.assign(e,{show:te,hide:oe,tableCurrent:re,tableMax:ne,tableMin:ie,zoomToExtent:So}),e.hover&&typeof e.hover!="function"&&vo(e),e.filter=e.filter||{},e.filter.current=e.filter.current||{},e.style&&e.style.themes&&(e.style.theme=e.style.theme||e.style.themes[Object.keys(e.style.themes)[0]]),Object.keys(e).forEach(t=>{mapp.plugins[t]&&mapp.plugins[t](e)}),e}function vo(e){let t=e.hover.field,o=e.hover.query||"infotip";e.hover=()=>mapp.utils.xhr(`${e.mapview.host}/api/query?`+mapp.utils.paramString({dbs:e.dbs,locale:e.mapview.locale.key,layer:e.key,template:o,qID:e.qID,id:e.highlight,table:e.tableCurrent(),geom:e.geom,field:t,coords:e.format==="cluster"&&ol.proj.transform(e.mapview.interaction.current.F.getGeometry().getCoordinates(),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`)})).then(r=>{!e.mapview.position||!r||r.label!=""&&e.mapview.infotip(r.label)})}async function So(e){let t=this,o=await mapp.utils.xhr(`${t.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:t.dbs,locale:t.mapview.locale.key,layer:t.key,table:t.table||Object.values(t.tables)[0]||Object.values(t.tables)[1],geom:t.geom,proj:t.srid,srid:t.mapview.srid,filter:t.filter.current})),r=/\((.*?)\)/.exec(o.box2d)[1].replace(/ /g,",");t.mapview.fitView(r.split(",").map(i=>parseFloat(i)),e)}var Ye=e=>t=>{let o=t.getProperties();if(e.type==="cluster"&&(o.count=t.get("features").length),e.featureLookup){let c=e.featureLookup.find(u=>u.id===o.id);if(!c)return;Object.assign(o,c)}let r=Object.assign({},e.style.default,o.count&&o.count>1&&e.style.cluster||{},e.style.theme?.style||{});Object.assign(r,{label:e.style.label||null});let i=t.getGeometry().getType();if(i==="Point"){if(typeof r.icon=="function")return r.icon(t);r.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),r.icon=Object.assign({},r.icon||mapp.utils.clone(r))}else delete r.icon;delete r.scale,delete r.clusterScale;let n=e.style.theme;if(n&&n.type==="categorized"){var s=o.cat||o[n.field],l=n.cat&&(n.cat[s]?.style||n.cat[s]);if(s&&typeof l>"u"){var p=Object.values(n.cat).filter(u=>Array.isArray(u.keys)).find(u=>u.keys.includes(s)),l=mapp.utils.clone(p.style||p);delete l.label}typeof l<"u"&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(r,l))}if(n&&n.type==="graduated"){var s=parseFloat(o.cat||o[n.field]);if(!isNaN(s)){for(let u=0;u<n.cat_arr.length&&!(s<parseFloat(n.cat_arr[u].value));u++){var l=mapp.utils.clone(n.cat_arr[u].style||n.cat_arr[u]);delete l.label}l&&(l.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),l.icon=i==="Point"&&mapp.utils.clone(l.icon||l),delete l.label,mapp.utils.merge(r,l))}}r.icon?.clusterScale&&(r.icon.clusterScale=e.style.logScale?Math.log(r.icon.clusterScale)/Math.log(e.max_size)*Math.log(o.size||o.count):1+r.icon.clusterScale/e.max_size*(o.size||o.count)),r.icon?.zoomInScale&&(r.icon.zoomInScale*=e.mapview.Map.getView().getZoom()),r.icon?.zoomOutScale&&(r.icon.zoomOutScale/=e.mapview.Map.getView().getZoom());let a=t.get("id")||t.getId();if(e.highlight&&e.highlight===a){let c=mapp.utils.clone(e.style.highlight);i==="Point"?(c.icon=c.icon||c.marker||mapp.utils.clone(c),c.icon.highlightScale=c.icon.scale||1,delete c.icon.scale,delete c.scale):delete c.icon,mapp.utils.merge(r,c)}if(r.label&&(r.label.text=o.label||r.label.count&&o.count>1&&o.count,!r.label?.display&&delete r.label,r.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete r.label,r.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete r.label),!(e.mapview?.locations[`${e.key}!${o.id}`]&&(e.style.selected&&mapp.utils.merge(r,e.style.selected,{zIndex:1/0}),e.style.selected===null)))return mapp.utils.style(r,t)};import ko from"https://cdn.skypack.dev/pin/maplibre-gl@v1.15.2-vB8RUOzTJK9WkLajH5fD/mode=imports,min/optimized/maplibre-gl.js";var et=e=>{let t=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=new ko.Map({container:t,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:o=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(o.viewState.center),zoom:o.viewState.zoom-1,bearing:-o.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var tt=e=>{let t=e.proxy&&`${e.mapview.host}/api/proxy?url=${e.URI}`||e.URI,o=new ol.source.OSM({url:decodeURIComponent(t),opaque:!1,transition:0});e.L=new ol.layer.Tile({source:o,layer:e,zIndex:e.style.zIndex||0})};var ot=e=>{e.reload=()=>{t.refresh()},e.snapSource=new ol.source.VectorTile({format:new ol.format.MVT({featureClass:ol.Feature}),transition:0,cacheSize:0,tileUrlFunction:o});let t=new ol.source.VectorTile({format:new ol.format.MVT,transition:0,cacheSize:0,tileUrlFunction:o});function o(r){let i=e.tableCurrent();return i?`${e.mapview.host}/api/layer/mvt/${r[0]}/${r[1]}/${r[2]}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:i,filter:e.filter&&e.filter.current}):t.clear()}e.L=new ol.layer.VectorTile({key:e.key,source:t,renderBuffer:200,zIndex:e.style.zIndex||1,style:mapp.layer.style(e)})};var rt=e=>{e.highlight=!0,e.reload=t;function t(){if(!e.display)return;e.xhr&&e.xhr.abort();let o=e.tableCurrent();if(!o){e.L.getSource().clear();return}let r=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/cluster/${e.mapview.Map.getView().getZoom()}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:o,kmeans:e.cluster_kmeans||void 0,dbscan:e.cluster_dbscan||void 0,resolution:e.cluster_resolution||void 0,hexgrid:e.cluster_hexgrid,theme:e.style.theme?.type,size:e.style.theme?.size,cat:e.style.theme?.fieldfx||e.style.theme?.field,aggregate:e.style.theme?.aggregate,label:e.style.label?.field,label_template:e.style.label?.template,filter:e.filter?.current,viewport:[r[0],r[1],r[2],r[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let n=i.target.response;e.max_size=n.reduce((p,a)=>Math.max(p,a.properties.size||a.properties.count),0);let s=1,l=n.map(p=>new ol.Feature(Object.assign({id:s++,geometry:new ol.geom.Point(e.srid==4326&&ol.proj.fromLonLat([p.geometry.x,p.geometry.y])||[p.geometry.x,p.geometry.y])},p.properties)));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:l}))},e.xhr.send()}e.L=new ol.layer.Vector({key:e.key,layer:e,zIndex:e.style.zIndex||10,style:mapp.layer.style(e)}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",t)};var Eo=new ol.format.GeoJSON,nt=e=>{e.reload=t;function t(){mapp.utils.xhr(`${e.mapview.host}/api/layer/geojson?${mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:e.table,filter:e.filter&&e.filter.current})}`).then(o=>{let r=o.map(s=>new ol.Feature({id:s.id,geometry:Eo.readGeometry(s.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:s.properties})),i=new ol.source.Vector({features:r}),n=e.type==="cluster"&&new ol.source.Cluster({distance:e.cluster_distance,source:i});e.L.setSource(n||i)})}e.L=new ol.layer.Vector({key:e.key,zIndex:e.style.zIndex||1,style:e.styleFunction||mapp.layer.style(e)})};var it=e=>{e.grid_size=Object.values(e.grid_fields)[0],e.grid_color=Object.values(e.grid_fields)[1],e.grid_ratio=!1,e.reload=t;function t(){if(!e.display)return;e.xhr&&e.xhr.abort();let o=e.tableCurrent();if(!o){e.L.getSource().clear();return}let r=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/grid?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:o,size:e.grid_size,color:e.grid_color,viewport:[r[0],r[1],r[2],r[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=i=>{if(i.target.status!==200)return;let n=i.target.response;e.sizeAvg=0,e.colorAvg=0;let s=n.map(c=>{if(parseFloat(c[2])>0)return c[2]=isNaN(c[2])?c[2]:parseFloat(c[2]),c[3]=isNaN(c[3])?c[3]:parseFloat(c[3]),e.grid_ratio&&c[3]>0&&(c[3]/=c[2]),e.sizeAvg+=parseFloat(c[2]),e.colorAvg+=isNaN(c[3])?0:parseFloat(c[3]),new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([c[0],c[1]])),properties:{size:parseFloat(c[2]),color:isNaN(c[3])?c[3]:parseFloat(c[3])}})});function l(c,u,h){let g=c.filter(x=>isFinite(x[u]));return Math[h].apply(null,g.map(x=>x[u]))}e.sizeMin=l(n,2,"min"),e.sizeAvg/=s.length,e.sizeMax=l(n,2,"max"),e.colorMin=l(n,3,"min"),e.colorAvg/=s.length,e.colorMax=l(n,3,"max"),e.colorBins=[];let p=e.style.range.length;for(var a=1;a<p;a++)a<p/2&&e.colorBins.push(e.colorMin+(e.colorAvg-e.colorMin)/(p/2)*a),a===p/2&&e.colorBins.push(e.colorAvg),a>p/2&&e.colorBins.push(e.colorAvg+(e.colorMax-e.colorAvg)/(p/2)*(a-p/2));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:s})),e.style.legend?.dispatchEvent(new Event("update"))},e.xhr.send()}e.L=new ol.layer.Vector({zIndex:e.style.zIndex||1,style:o=>{let r=o.getProperties().properties,i=r.size<=e.sizeAvg?7+7/e.sizeAvg*r.size:14+7/(e.sizeMax-e.sizeAvg)*(r.size-e.sizeAvg);if(r.hxcolor=e.style.hxcolor||"#C0C0C0",parseFloat(r.color)){r.hxcolor=e.style.range[0];for(let n=0;n<e.colorBins.length&&!(r.color<e.colorBins[n]);n++)r.hxcolor=e.style.range[n+1]}return mapp.utils.style({icon:{type:"dot",fillColor:r.hxcolor,scale:i/30}})}}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",t)};var st={mbtiles:et,tiles:tt,mvt:ot,cluster:rt,geojson:nt,grid:it};var lt={decorate:Qe,style:Ye,format:st};var at=e=>(Object.assign(e,{flyTo:Lo,Layers:[],remove:Mo,removeCallbacks:[],trash:$o,update:Co,updateCallbacks:[]}),e);function Mo(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.format==="mvt"?this.layer.L.changed():this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function Co(){let e={};if(this.infoj.filter(o=>typeof o.newValue<"u").forEach(o=>{o.type==="integer"&&(o.newValue=isNaN(parseInt(o.newValue))?null:o.newValue),o.type==="numeric"&&(o.newValue=isNaN(parseFloat(o.newValue))?null:o.newValue),Object.assign(e,{[o.field]:o.newValue})}),!Object.keys(e).length)return;await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/location/update?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)});let t=this.infoj.filter(o=>typeof o.newValue<"u").filter(o=>o.dependents&&o.dependents.length).map(o=>o.dependents).flat();if(this.infoj.filter(o=>typeof o.newValue<"u").forEach(o=>{o.value=o.newValue,delete o.newValue}),t.length){let o=await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:[...new Set(t)].join()}));this.infoj.filter(r=>typeof o[r.field]<"u").forEach(r=>{r.value=o[r.field]})}this.layer.reload(),this.updateCallbacks?.forEach(o=>typeof o=="function"&&o(this))}function Lo(){let e=new ol.source.Vector;this.Layers.forEach(t=>{let o=t.getSource();typeof o.getFeatures=="function"&&e.addFeatures(o.getFeatures())}),this.layer.mapview.fitView(e.getExtent())}async function $o(){!confirm(mapp.dictionary.confirm_delete)||(await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/delete?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.layer.reload(),this.remove())}async function ct(e,t=e.layer.mapview.locations){if(!e.layer||!e.id)return;if(e.table=e.table||e.layer.table||Object.values(e.layer.tables).find(i=>!!i),e.hook=`${e.layer.key}!${e.id}`,t[e.hook]){t[e.hook].remove(),delete t[e.hook];return}let o=await mapp.utils.xhr(`${e.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.table,id:e.id})),r=e.layer.infoj.map(i=>{let n=mapp.utils.clone(i);return Object.assign(n,{title:o[n.field+"_label"]||n.title,value:o[n.field],location:e}),n});return mapp.location.decorate(Object.assign(e,{infoj:r})),t[e.hook]=e,e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}async function pt(e){let t=e.feature.getProperties(),o=e.feature.getGeometry(),r=o.getCoordinates(),i=ol.proj.transform(r,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),n=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,cluster_label:e.layer.cluster_label||e.layer.qID,table:e.table,n:t.count>(e.max||99)?e.max||99:t.count,x:i[0],y:i[1],coords:i})),s=mapp.utils.html.node`
    <div style="
      max-width: 66vw;
      max-height: 300px;
      overflow-x: hidden;">
      <ul>
      ${n.map(l=>mapp.utils.html.node`
        <li
          onclick=${p=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:l.id,marker:ol.proj.transform(l.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${l.label||'"'+e.layer.cluster_label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(i,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:s,autoPan:!0})}var ut={decorate:at,get:ct,nnearest:pt};function dt(e){if(!Array.isArray(e))return;let t=this.hooks&&mapp.hooks.current.layers.length;return e.forEach((o,r)=>{let i=mapp.utils.clone(o);i.mapview=this,t&&(i.display=!!~mapp.hooks.current.layers.indexOf(i.key)),mapp.layer.decorate(i),this.layers[i.key]=i,i.display&&i.show()}),e}function ft(e,t={}){this.Map.getView().fit(e,Object.assign({padding:[50,50,50,50],duration:1e3},t))}function mt(e){let t=this.Map.getView().calculateExtent();if(!e)return{south:t[1],west:t[0],north:t[3],east:t[2]};let o=ol.proj.transformExtent(t,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:o[1],west:o[0],north:o[3],east:o[2]}}var Fo=new ol.format.GeoJSON;function ht(e){let t=e.geometry&&Fo.readFeature({type:"Feature",geometry:e.geometry},{dataProjection:`EPSG:${e.dataProjection||this.srid}`,featureProjection:`EPSG:${this.srid}`}),o=new ol.source.Vector;t&&o.addFeature(t);let r=new ol.layer.Vector({source:o,zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(r),r}var y={};function gt(e){let t=this;if(y.node?.remove(),t.Map.un("pointermove",o),!e)return;y.node=mapp.utils.html.node`<div class="infotip">`,y.node.innerHTML=e,t.Map.getTargetElement().appendChild(y.node),t.Map.on("pointermove",o);function o(){y.node.style.opacity=1,y.node.style.left=t.pointerLocation.x-y.node.offsetWidth/2+"px",y.node.style.top=t.pointerLocation.y-y.node.offsetHeight-15+"px"}}var se;function xt(e){let t=Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e);if(se=!se,t.L||(t.L=new ol.layer.Vector({source:new ol.source.Vector({features:[t.feature]}),zIndex:40,style:mapp.utils.style({icon:t.icon})})),!se){this.Map.removeLayer(t.L);return}this.Map.addLayer(t.L),mapp.utils.getCurrentPosition(o=>{let r=ol.proj.fromLonLat([parseFloat(o.coords.longitude),parseFloat(o.coords.latitude)]);t.feature.getGeometry().setCoordinates(r),this.Map.getView().animate({center:r,zoom:this.locale.maxZoom})})}var v={};function wt(e){let t=this;v.node?.remove(),e&&(v.node=mapp.utils.html.node`<div class="popup">`,v.node.appendChild(e.content),v.overlay&&t.Map.removeOverlay(v.overlay),v.overlay=new ol.Overlay({element:v.node,position:e.coords||t.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),t.Map.addOverlay(v.overlay))}var O,le,M,P,ae;function bt(e){if(e===null){this.Map.removeInteraction(ae),M&&M.un("tileloadend",yt),P&&this.Map.removeLayer(P),P=null,this.Map.removeLayer(le);return}!e.snapSource&&!e.snapLayer||(O=e.snapSource||new ol.source.Vector,le=new ol.layer.Vector({source:O,opacity:0}),this.Map.addLayer(le),e.snapLayer?.snapSource?(M=e.snapLayer.snapSource,M.on("tileloadend",yt),P=new ol.layer.VectorTile({source:M,opacity:0}),this.Map.addLayer(P),M.refresh()):e.snapLayer&&(O=e.snapLayer.L.getSource()),ae=new ol.interaction.Snap({source:O}),this.Map.addInteraction(ae))}function yt(e){O.addFeatures(e.tile.getFeatures())}function vt(e){let t=this;t.interaction?.finish();let o=Object.assign({type:"highlight",finish:r,clear:s,highlight:n,getLocation:p,hitTolerance:5,candidateKeys:new Set,layerFilter:a=>Object.values(t.layers).some(c=>c.qID&&c.L===a)},e);t.interaction=o,t.Map.on("pointermove",i),t.Map.on("singleclick",l),t.Map.getTargetElement().addEventListener("mouseout",s),t.Map.getTargetElement().style.cursor="auto";function r(){delete t.interaction,t.Map.un("pointermove",i),t.Map.un("singleclick",l),t.Map.getTargetElement().removeEventListener("mouseout",s)}function i(a){let c,u={};if(t.Map.forEachFeatureAtPixel(a.pixel,(h,g)=>{let x={key:`${g.get("key")||ol.util.getUid(g)}!${h.get("id")||h.getId()||ol.util.getUid(h)}`,F:h,L:g};u[x.key]=x},{layerFilter:o.layerFilter,hitTolerance:o.hitTolerance}),mapp.utils.areSetsEqual(o.candidateKeys,new Set(Object.keys(u))))return o.highlight("noChange",a);c=u[Object.keys(u).find(h=>!o.candidateKeys.has(h))],c=c||o.current?.key&&u[o.current?.key]||u[Object.keys(u)[0]],o.candidateKeys=new Set(Object.keys(u)),o.highlight(c,a)}function n(a,c){a!=="noChange"&&(s(),a&&(o.current=Object.assign(a,{layer:t.layers[a.L.get("key")],id:a.F.get("id")||a.F.getId()}),o.current.layer.highlight=a.id,c.originalEvent.pointerType!=="touch"&&(o.current.layer.infoj&&(t.Map.getTargetElement().style.cursor="pointer"),typeof o.current.layer.hover=="function"&&o.current.layer.hover(a.F),o.current.layer.format!=="mvt"&&typeof o.current.F.setStyle=="function"?(a.F.set("highlight",!0),o.current.F.setStyle()):o.current.layer.style.highlight&&o.current.layer.L.changed())))}function s(){!o.current||(t.infotip(null),t.Map.getTargetElement().style.cursor="auto",delete o.current.layer.highlight,o.current.layer.format!=="mvt"&&typeof o.current.F.setStyle=="function"?(o.current.F.set("highlight",!1),o.current.F.setStyle()):o.current.layer.style.highlight&&o.current.layer.L.changed(),delete o.current)}async function l(a){a.originalEvent.pointerType==="touch"&&i(a),t.popup(null),o.current&&o.getLocation(o.current)}function p(a){if(a.F.getProperties().count>1){mapp.location.nnearest({mapview:t,layer:a.layer,table:a.layer.table||a.layer.tableCurrent(),feature:a.F});return}mapp.location.get({layer:a.layer,table:a.layer.table||a.layer.tableCurrent(),id:a.layer.highlight})}}function St(e){let t=this;t.interaction?.finish();let o=Object.assign({type:"draw",finish:n,format:new ol.format.GeoJSON,Layer:new ol.layer.Vector({source:new ol.source.Vector}),contextMenu:mapp.ui?.elements.contextMenu.draw.bind(t),metricFunction:r,vertices:[],srid:t.srid,getFeature:i,style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);t.Map.getTargetElement().style.cursor="crosshair",t.Map.addLayer(o.Layer),o.interaction=new ol.interaction.Draw({source:o.Layer.getSource(),geometryFunction:o.geometryFunction,freehand:o.freehand,type:o.type,style:o.style,condition:s=>{if(o.kinks)return!1;if(s.originalEvent.buttons===1)return o.vertices.push(s.coordinate),t.popup(null),typeof o.condition=="function"&&o.condition(s),!0}}),o.interaction.on("drawstart",s=>{o.tooltip&&o.metricFunction(s.feature.getGeometry(),o.tooltip),s.feature.setStyle(o.style),o.Layer.getSource().clear(),t.popup(null)}),o.interaction.on("drawend",s=>{if(o.drawend)return o.drawend(s);typeof o.contextMenu=="function"&&setTimeout(o.contextMenu,400)}),t.interaction=o,t.Map.addInteraction(o.interaction),t.snapSource(modify),typeof o.contextMenu=="function"&&t.Map.getTargetElement().addEventListener("contextmenu",o.contextMenu);function r(s,l){let p={distance:()=>ol.sphere.getLength(new ol.geom.LineString([s.getInteriorPoint().getCoordinates(),_xyz.mapview.position])),area:()=>ol.sphere.getArea(s),length:()=>ol.sphere.getLength(s)};!p[l]||s.on("change",()=>{t.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">${parseInt(p[l]()).toLocaleString("en-GB")+(l==="area"?"sqm":"m")}`})})}function i(){let s=o.Layer.getSource().getFeatures();return JSON.parse(o.format.writeFeature(s[0],{dataProjection:"EPSG:"+o.srid,featureProjection:"EPSG:"+t.srid}))}function n(s){delete t.interaction,o.callback&&o.callback(s),t.popup(null),typeof o.contextMenu=="function"&&t.Map.getTargetElement().removeEventListener("contextmenu",o.contextMenu),t.snapSource(null),t.Map.removeInteraction(o.interaction),t.Map.removeLayer(o.Layer),o.Layer.getSource().clear(),t.Map.getTargetElement().style.cursor="default"}}function kt(e){let t=this;t.interaction?.finish();let o=Object.assign({type:"modify",finish:i,format:new ol.format.GeoJSON,Source:new ol.source.Vector,vertices:[],srid:t.srid,contextMenu:mapp.ui?.elements.contextMenu.modify.bind(t),getFeature:r,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e);t.Map.getTargetElement().style.cursor="crosshair",o.Feature&&o.Source.addFeature(o.Feature),o.Layer=new ol.layer.Vector({source:o.Source,zIndex:9999,style:o.Style}),t.Map.addLayer(o.Layer),o.interaction=new ol.interaction.Modify({source:o.Source,deleteCondition:n=>{if(n.type==="singleclick"){let s=o.Feature.getGeometry(),l=s.getType();if(l==="Point")return;let p=s.getCoordinates();if(l==="LineString"&&p.length<3||p[0].length<=4)return;t.popup({coords:o.Feature.getGeometry().getClosestPoint(n.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{o.interaction.removePoint(),o.vertices.push(o.Feature.getGeometry().getClosestPoint(n.coordinate))}}>${mapp.dictionary.delete_vertex}`})}}}),o.interaction.on("modifystart",n=>{t.popup(null)}),o.interaction.on("modifyend",n=>{if(o.vertices.push(n.mapBrowserEvent.coordinate),o.modifyend)return o.modifyend(n,o);typeof o.contextMenu=="function"&&setTimeout(o.contextMenu,400)}),t.interaction=o,t.Map.addInteraction(o.interaction),t.snapSource(o);function r(){return JSON.parse(o.format.writeFeature(o.Feature,{dataProjection:"EPSG:"+o.srid,featureProjection:"EPSG:"+t.srid}))}function i(n){delete t.interaction,o.callback&&o.callback(n),t.popup(null),t.snapSource(null),t.Map.removeInteraction(o.interaction),t.Map.removeLayer(o.Layer),o.Source.clear(),t.Map.getTargetElement().style.cursor="default"}}function Et(e){let t=this;t.interaction?.finish();let o={finish:r,Layer:new ol.layer.Vector({source:new ol.source.Vector})};t.interaction=o,o.callback=e.callback,o.Layer.getSource().clear(),t.Map.addLayer(o.Layer),t.Map.getTargetElement().style.cursor="zoom-in",o.interaction=new ol.interaction.Draw({source:o.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ddd",width:1}),fill:new ol.style.Stroke({color:"#fff9"})})}),o.interaction.on("drawend",i=>{t.fitView(i.feature.getGeometry().getExtent()),r()}),t.Map.addInteraction(o.interaction);function r(){delete t.interaction,o.callback&&(o.callback(),delete o.callback),t.Map.getTargetElement().style.cursor="auto",t.Map.removeInteraction(o.interaction),t.Map.removeLayer(o.Layer),o.Layer.getSource().clear()}}var Mt=e=>{Object.assign(e,{srid:e.locale.srid||"3857",addLayer:dt,fitView:ft,geoJSON:ht,getBounds:mt,infotip:gt,locate:xt,popup:wt,snapSource:bt,layers:{},locations:{},interactions:{highlight:vt.bind(e),draw:St.bind(e),modify:kt.bind(e),zoom:Et.bind(e)}});let t=mapp.hooks?.current?.z||e.locale.view?.z||e.locale.minZoom||0,o=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.locale.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.locale.view?.lat||0)]);e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent");let r=e.locale.extent&&ol.proj.transformExtent([parseFloat(e.locale.extent.west||-180),parseFloat(e.locale.extent.south||-90),parseFloat(e.locale.extent.east||180),parseFloat(e.locale.extent.north||90)],"EPSG:4326",`EPSG:${e.srid}`);if(e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults({mouseWheelZoom:e.scrollWheelZoom||!1,PinchRotate:{threshold:3}}),controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:t,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:o,extent:r})}),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let n=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],s=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],l=new ol.Feature({geometry:new ol.geom.Polygon([n,s]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[l]}),style:new ol.style.Style({fill:new ol.style.Fill({color:"#00000044"})}),zIndex:1/0}))}e.scalebar&&e.Map.addControl(new ol.control.ScaleLine({units:e.scalebar})),e.attribution&&(typeof e.attribution!="object"&&(e.attribution={}),e.attribution.target=e.attribution.target||e.Map.getTargetElement().appendChild(mapp.utils.html.node`
          <div class="attribution-links">`),e.attribution.check=()=>{let n=Object.assign({},e.attribution.links||{});Object.values(e.layers).forEach(s=>{s.display&&s.attribution&&Object.assign(n,s.attribution)}),mapp.utils.render(e.attribution.target,mapp.utils.html`${Object.entries(n).map(s=>mapp.utils.html`
              <a class="background-fade" target="_blank" href="${s[1]}">${s[0]}`)}`)}),e.Map.on("pointermove",n=>{e.position=n.coordinate,e.pointerLocation={x:n.originalEvent.clientX,y:n.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.hooks)return;let n=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:n[1],lng:n[0],z:e.Map.getView().getZoom()})});let i;return e.Map.on("moveend",()=>{clearTimeout(i),i=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),e};G.parse();var k={version:"4.\u03B2",hash:"c85386246d221638769d54dc779419b19769d5b0",language:G.current.language||"en",dictionaries:Xe,dictionary:new Proxy({},{get:function(e,t,o){return k.dictionaries[k.language][t]?k.dictionaries[k.language][t]:k.dictionaries.en[t]}}),hooks:G,layer:lt,location:ut,Mapview:Mt,plugins:{},utils:Re};window.mapp=k;var xi=k;export{xi as default};
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=mapp.js.map
