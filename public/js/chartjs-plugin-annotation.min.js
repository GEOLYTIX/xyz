/*!
* chartjs-plugin-annotation v1.0.0
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2021 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["chartjs-plugin-annotation"]=e(t.Chart,t.Chart.helpers)}(this,(function(t,e){"use strict";const n=["click","dblclick"],i=["enter","leave"],o=n.concat(i);function a(t,e,n,i){if(e.listened)switch(n.type){case"mousemove":case"mouseout":!function(t,e,n){if(!e.moveListened)return;let i;"mousemove"===n.type&&(i=r(e.elements,n));const o=e.hovered;e.hovered=i,function(t,e,n,i){n&&n!==i&&s(t,e,n.options.leave||e.listeners.leave,n);i&&i!==n&&s(t,e,i.options.enter||e.listeners.enter,i)}(t,e,o,i)}(t,e,n);break;case"click":!function(t,e,n,i){const o=e.listeners,a=r(e.elements,n);if(a){const n=a.options,r=n.dblclick||o.dblclick,l=n.click||o.click;a.clickTimeout?(clearTimeout(a.clickTimeout),delete a.clickTimeout,s(t,e,r,a)):r?a.clickTimeout=setTimeout((()=>{delete a.clickTimeout,s(t,e,l,a)}),i.dblClickSpeed):s(t,e,l,a)}}(t,e,n,i)}}function s(t,n,i,o){e.callback(i,[{chart:t,element:o}])}function r(t,n){let i=Number.POSITIVE_INFINITY;return t.filter((t=>t.options.display&&t.inRange(n.x,n.y))).reduce(((t,o)=>{const a=o.getCenterPoint(),s=e.distanceBetweenPoints(n,a);return s<i?(t=[o],i=s):s===i&&t.push(o),t}),[]).sort(((t,e)=>t._index-e._index)).slice(0,1)[0]}const l=Math.PI,d=l/2;function c(t,n,i){return n="number"==typeof n?n:t.parse(n),n=e.isFinite(n)?t.getPixelForValue(n):i,function(t,e){const n=t.chart.chartArea;return t.isHorizontal()?e>=n.left&&e<=n.right:e>=n.top&&e<=n.bottom}(t,n)?n:i}function h(t,e,n,i,o,a){if(t.beginPath(),a){const s=Math.min(a,o/2,i/2),r=e+s,c=n+s,h=e+i-s,f=n+o-s;t.moveTo(e,c),r<h&&c<f?(t.arc(r,c,s,-l,-d),t.arc(h,c,s,-d,0),t.arc(h,f,s,0,d),t.arc(r,f,s,d,l)):r<h?(t.moveTo(r,n),t.arc(h,c,s,-d,d),t.arc(r,c,s,d,l+d)):c<f?(t.arc(r,c,s,-l,0),t.arc(r,f,s,0,l)):t.arc(r,c,s,-l,l),t.closePath(),t.moveTo(e,n)}else t.rect(e,n,i,o)}class f extends t.Element{inRange(t,e,n){const{x:i,y:o,width:a,height:s}=this.getProps(["x","y","width","height"],n);return t>=i&&t<=i+a&&e>=o&&e<=o+s}getCenterPoint(t){const{x:e,y:n,width:i,height:o}=this.getProps(["x","y","width","height"],t);return{x:e+i/2,y:n+o/2}}draw(t){const{x:e,y:n,width:i,height:o,options:a}=this;t.save(),t.lineWidth=a.borderWidth,t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,t.setLineDash(a.borderDash),t.lineDashOffset=a.borderDashOffset,h(t,e,n,i,o,a.cornerRadius),t.fill(),a.borderWidth&&t.stroke(),t.restore()}resolveElementProperties(t,e){const n=t.scales[e.xScaleID],i=t.scales[e.yScaleID];let o,a,{top:s,left:r,bottom:l,right:d}=t.chartArea;return n||i?(n&&(o=c(n,e.xMin,r),a=c(n,e.xMax,d),r=Math.min(o,a),d=Math.max(o,a)),i&&(o=c(i,e.yMin,l),a=c(i,e.yMax,s),s=Math.min(o,a),l=Math.max(o,a)),{x:r,y:s,x2:d,y2:l,width:d-r,height:l-s}):{options:{}}}}f.id="boxAnnotation",f.defaults={display:!0,borderDash:[],borderDashOffset:0,borderWidth:1,cornerRadius:0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},f.defaultRoutes={borderColor:"color",backgroundColor:"color"};const u=Math.PI,x=(t,e,n)=>({x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)});class y extends t.Element{intersects(t,e,n){n=n||.001;const i=this,o={x:i.x,y:i.y},a={x:i.x2,y:i.y2},s=((t,e,n)=>x(e,n,Math.abs((t-e.x)/(n.x-e.x))).y)(t,o,a),r=((t,e,n)=>x(e,n,Math.abs((t-e.y)/(n.y-e.y))).x)(e,o,a);return(!isFinite(s)||Math.abs(e-s)<n)&&(!isFinite(r)||Math.abs(t-r)<n)}labelIsVisible(){const t=this.options.label;return t&&t.enabled&&t.content}isOnLabel(t,e){const{labelRect:n}=this;if(!n)return!1;const{x:i,y:o}=(a={x:t,y:e},s=n,r=-n.rotation,l=Math.cos(r),d=Math.sin(r),c=s.x,h=s.y,{x:c+l*(a.x-c)-d*(a.y-h),y:h+d*(a.x-c)+l*(a.y-h)});var a,s,r,l,d,c,h;const f=n.width/2,u=n.height/2;return i>=n.x-f&&i<=n.x+f&&o>=n.y-u&&o<=n.y+u}inRange(t,e){const n=this.options.borderWidth||1;return this.intersects(t,e,n)||this.isOnLabel(t,e)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(t){const{x:e,y:n,x2:i,y2:o,options:a}=this;t.save(),t.lineWidth=a.borderWidth,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash),t.lineDashOffset=a.borderDashOffset,t.beginPath(),t.moveTo(e,n),t.lineTo(i,o),t.stroke(),t.restore()}drawLabel(t,n){this.labelIsVisible()&&(t.save(),function(t,n,i){const o=n.options.label;t.font=e.toFontString(o.font);const{width:a,height:s}=function(t,n){const i=n.content;if(i instanceof Image)return{width:b(i.width,n.width)+2*n.xPadding,height:b(i.height,n.height)+2*n.yPadding};const o=e.isArray(i)?i:[i],a=o.length;let s=0;for(let e=0;e<a;e++){const n=o[e];p.has(n)||p.set(n,t.measureText(n).width),s=Math.max(s,p.get(n))}return s+=2*n.xPadding,{width:s,height:a*n.font.size+(a+1)*n.yPadding}}(t,o),r=n.labelRect=function(t,n,i,o){const a=t.options.label,{xAdjust:s,yAdjust:r,xPadding:l,yPadding:d,position:c}=a,h={x:t.x,y:t.y},f={x:t.x2,y:t.y2},y="auto"===a.rotation?function(t){const{x:e,y:n,x2:i,y2:o}=t,a=Math.atan2(o-n,i-e);return a>u/2?a-u:a<u/-2?a+u:a}(t):e.toRadians(a.rotation),b=function(t,e,n){const i=Math.cos(n),o=Math.sin(n);return{w:Math.abs(t*i)+Math.abs(e*o),h:Math.abs(t*o)+Math.abs(e*i)}}(n,i,y),p=function(t,e,n,i){let o=.5;const a=function(t,e){const{x:n,x2:i,y:o,y2:a}=t,s=Math.min(o,a)-e.top,r=Math.min(n,i)-e.left,l=e.bottom-Math.max(o,a),d=e.right-Math.max(n,i);return{x:Math.min(r,d),y:Math.min(s,l),dx:r<d?1:-1,dy:s<l?1:-1}}(t,i),s=t.options.label;"start"===e?o=g({w:t.x2-t.x,h:t.y2-t.y},n,s,a):"end"===e&&(o=1-g({w:t.x-t.x2,h:t.y-t.y2},n,s,a));return o}(t,c,b,o),M=x(h,f,p),w={size:b.w,min:o.left,max:o.right,padding:l},v={size:b.h,min:o.top,max:o.bottom,padding:d};return{x:m(M.x,w)+s,y:m(M.y,v)+r,width:n,height:i,rotation:y}}(n,a,s,i);if(t.translate(r.x,r.y),t.rotate(r.rotation),t.fillStyle=o.backgroundColor,h(t,-a/2,-s/2,a,s,o.cornerRadius),t.fill(),t.fillStyle=o.color,e.isArray(o.content)){t.textAlign=o.textAlign;const e=function(t,e){const{textAlign:n,xPadding:i}=t;if("start"===n)return-e/2+i;if("end"===n)return+e/2-i;return 0}(o,a);let n=-s/2+o.yPadding;for(let i=0;i<o.content.length;i++)t.textBaseline="top",t.fillText(o.content[i],e,n),n+=o.font.size+o.yPadding}else if(o.content instanceof Image){const e=-a/2+o.xPadding,n=-s/2+o.yPadding;t.drawImage(o.content,e,n,a-2*o.xPadding,s-2*o.yPadding)}else t.textAlign="center",t.textBaseline="middle",t.fillText(o.content,0,0)}(t,this,n),t.restore())}resolveElementProperties(t,e){const n=t.scales[e.scaleID];let i,o,{top:a,left:s,bottom:r,right:l}=t.chartArea;if(n)i=c(n,e.value,NaN),o=c(n,e.endValue,i),n.isHorizontal()?(s=i,l=o):(a=i,r=o);else{const n=t.scales[e.xScaleID],i=t.scales[e.yScaleID];n&&(s=c(n,e.xMin,s),l=c(n,e.xMax,l)),i&&(a=c(i,e.yMin,a),r=c(i,e.yMax,r))}return{x:s,y:a,x2:l,y2:r,width:l-s,height:r-a}}}function b(t,e){return"number"==typeof e?e:"string"==typeof e?("string"==typeof(n=e)&&n.endsWith("%")&&parseFloat(n)/100)*t:t;var n}y.id="lineAnnotation",y.defaults={display:!0,borderWidth:2,borderDash:[],borderDashOffset:0,label:{backgroundColor:"rgba(0,0,0,0.8)",drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:"bold",weight:void 0},color:"#fff",xPadding:6,yPadding:6,rotation:0,cornerRadius:6,position:"center",xAdjust:0,yAdjust:0,textAlign:"center",enabled:!1,content:null},value:void 0,endValue:void 0,scaleID:void 0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},y.defaultRoutes={borderColor:"color"};const p=new Map;function g(t,e,n,i){const{xPadding:o,yPadding:a}=n,s=t.w*i.dx,r=t.h*i.dy,l=s>0&&(e.w/2+o-i.x)/s,d=r>0&&(e.h/2+a-i.y)/r;return Math.max(Math.min(Math.max(l,d),.25),0)}function m(t,e){const{size:n,min:i,max:o,padding:a}=e,s=n/2;return n>o-i?(o+i)/2:(i>=t-a-s&&(t=i+a+s),o<=t+a+s&&(t=o-a-s),t)}class M extends f{inRange(t,e){return function(t,e){const{width:n,height:i}=e,o=e.getCenterPoint(!0),a=n/2,s=i/2;if(a<=0||s<=0)return!1;return Math.pow(t.x-o.x,2)/Math.pow(a,2)+Math.pow(t.y-o.y,2)/Math.pow(s,2)<=1}({x:t,y:e},this)}draw(t){const{width:e,height:n,options:i}=this,o=this.getCenterPoint();t.save(),t.beginPath(),t.lineWidth=i.borderWidth,t.strokeStyle=i.borderColor,t.fillStyle=i.backgroundColor,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,t.ellipse(o.x,o.y,n/2,e/2,Math.PI/2,0,2*Math.PI),t.fill(),t.stroke(),t.restore()}}M.id="ellipseAnnotation",M.defaults={display:!0,borderDash:[],borderDashOffset:0,borderWidth:1,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},M.defaultRoutes={borderColor:"color",backgroundColor:"color"};class w extends t.Element{inRange(t,e){const{width:n,options:i}=this,o=this.getCenterPoint(!0),a=n/2+i.borderWidth;return!(a<=0)&&Math.pow(t-o.x,2)+Math.pow(e-o.y,2)<=Math.pow(a,2)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}draw(t){const{x:e,y:n,width:i,options:o}=this;t.save(),t.lineWidth=o.borderWidth,t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,t.setLineDash(o.borderDash),t.lineDashOffset=o.borderDashOffset,t.beginPath(),t.arc(e,n,i/2,0,2*Math.PI),t.fill(),t.stroke(),t.restore()}resolveElementProperties(t,e){const{chartArea:n,scales:i}=t,o=i[e.xScaleID],a=i[e.yScaleID];let s=n.width/2,r=n.height/2;return o&&(s=c(o,e.xValue,s)),a&&(r=c(a,e.yValue,r)),{x:s,y:r,width:2*e.radius,height:2*e.radius}}}w.id="pointAnnotation",w.defaults={display:!0,borderDash:[],borderDashOffset:0,borderWidth:1,radius:10,xScaleID:"x",xValue:void 0,yScaleID:"y",yValue:void 0},w.defaultRoutes={borderColor:"color",backgroundColor:"color"};const v=new Map,D={box:f,line:y,ellipse:M,point:w};Object.keys(D).forEach((e=>{t.defaults.describe("elements."+D[e].id,{_fallback:"plugins.annotation"})}));var P={id:"annotation",version:"1.0.0",afterRegister(){t.Chart.register(D)},afterUnregister(){t.Chart.unregister(D)},beforeInit(t){v.set(t,{annotations:[],elements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(t,n,i){const o=v.get(t).annotations=[];let a=i.annotations;e.isObject(a)?Object.keys(a).forEach((t=>{const n=a[t];e.isObject(n)&&(n.id=t,o.push(n))})):e.isArray(a)&&o.push(...a)},afterDataLimits(t,n){const i=v.get(t);!function(t,n,i){const o=function(t,n){const i=t.axis,o=t.id,a=i+"ScaleID";let s=e.valueOrDefault(t.min,Number.NEGATIVE_INFINITY),r=e.valueOrDefault(t.max,Number.POSITIVE_INFINITY);for(const e of n)if(e.scaleID===o)for(const n of["value","endValue"]){const i=e[n];if(i){const e=t.parse(i);s=Math.min(s,e),r=Math.max(r,e)}}else if(e[a]===o)for(const n of[i+"Min",i+"Max",i+"Value"]){const i=e[n];if(i){const e=t.parse(i);s=Math.min(s,e),r=Math.max(r,e)}}return{min:s,max:r}}(n,i);let a=!1;e.isFinite(o.min)&&void 0===n.options.min&&void 0===n.options.suggestedMin&&(a=n.min!==o.min,n.min=o.min);e.isFinite(o.max)&&void 0===n.options.max&&void 0===n.options.suggestedMax&&(a=n.max!==o.max,n.max=o.max);a&&"function"==typeof n.handleTickRangeOptions&&n.handleTickRangeOptions()}(0,n.scale,i.annotations.filter((t=>t.display)))},afterUpdate(e,a,s){const r=v.get(e);!function(t,e,a){const s=e.annotations||[];e.listened=!1,e.moveListened=!1,o.forEach((t=>{"function"==typeof a[t]&&(e.listened=!0,e.listeners[t]=a[t])})),i.forEach((t=>{"function"==typeof a[t]&&(e.moveListened=!0)})),e.listened&&e.moveListened||s.forEach((t=>{e.listened||n.forEach((n=>{"function"==typeof t[n]&&(e.listened=!0)})),e.moveListened||i.forEach((n=>{"function"==typeof t[n]&&(e.listened=!0,e.moveListened=!0)}))}))}(0,r,s),function(e,n,i,o){const a=function(e,n,i){if("reset"===i||"none"===i||"resize"===i)return I;return new t.Animations(e,n)}(e,i.animations,o),s=n.annotations,r=function(t,e){const n=e.length,i=t.length;if(i<n){const e=n-i;t.splice(i,0,...new Array(e))}else i>n&&t.splice(n,i-n);return t}(n.elements,s);for(let t=0;t<s.length;t++){const n=s[t];let i=r[t];const o=D[n.type]||D.line;i&&i instanceof o||(i=r[t]=new o);const l=k(n.setContext(C(e,i,n))),d=i.resolveElementProperties(e,l);d.skip=isNaN(d.x)||isNaN(d.y),d.options=l,a.update(i,d)}}(e,r,s,a.mode)},beforeDatasetsDraw(t){O(t,"beforeDatasetsDraw")},afterDatasetsDraw(t){O(t,"afterDatasetsDraw")},beforeDraw(t){O(t,"beforeDraw")},afterDraw(t){O(t,"afterDraw")},beforeEvent(t,e,n){a(t,v.get(t),e.event,n)},destroy(t){v.delete(t)},_getState:t=>v.get(t),defaults:{drawTime:"afterDatasetsDraw",dblClickSpeed:350,animations:{numbers:{properties:["x","y","x2","y2","width","height"],type:"number"}},label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:t=>!o.includes(t),annotations:{_allKeys:!1,_fallback:(t,e)=>"elements."+D[e.type||"line"].id}},additionalOptionScopes:[""]};const I={update:Object.assign};function k(t){const e=D[t.type]||D.line,n={};n.id=t.id,n.type=t.type,n.drawTime=t.drawTime,Object.assign(n,T(t,e.defaults),T(t,e.defaultRoutes));for(const e of o)n[e]=t[e];return n}function T(t,n){const i={};for(const o of Object.keys(n)){const a=n[o],s=t[o];i[o]=e.isObject(a)?T(s,a):s}return i}function C(t,e,n){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,id:n.id,type:"annotation"}))}function O(t,n){const{ctx:i,chartArea:o}=t,a=v.get(t).elements.filter((t=>!t.skip&&t.options.display));e.clipArea(i,o),a.forEach((t=>{t.options.drawTime===n&&t.draw(i)})),e.unclipArea(i),a.forEach((t=>{"drawLabel"in t&&t.options.label&&(t.options.label.drawTime||t.options.drawTime)===n&&t.drawLabel(i,o)}))}return t.Chart.register(P),P}));
//# sourceMappingURL=chartjs-plugin-annotation.min.js.map