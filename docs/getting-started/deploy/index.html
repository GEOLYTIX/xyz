<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="https://geolytix.github.io/xyz/public/icons/favicon.ico">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <title>Deployments</title>
  <style>

    html, body {
      margin: 0;
      padding: 0;
      height: 100%
    }

    .header-anchor {
      font-size: 80%;
    }

    .grid {
      font-family: system-ui;
      display:grid;
      grid-template-columns: 200px minmax(0, 1fr);
      max-width: 1100px;
      margin: auto;
      padding: 0 30px;
      height: 100%;
    }

    iframe {
      border: none;
    }

    #toggle {
        display: none;
    }

    #toggle:hover {
      cursor: pointer;
    }

    #nav {
      grid-column: 1;
      padding-inline-start: 0px;
      list-style-type: none;
      padding-right: 20px;
      margin: 3px 0;
      position: fixed;
    }

    #nav > *:first-child {
      line-height: 1;
      font-size: 30px;
      font-weight: bold;
    }

    #content {
      grid-column: 2;
      padding-left: 20px;
      border-left: 1px solid #ddd;
      margin: 10px 0;
    }

    #content > *:first-child {
      margin: 0;
    }

    .active {
      font-weight: bold;
    }

    a {
      text-decoration: none;
      white-space: nowrap;
      color: #333;
    }

    h1, h2, h3 {
      margin-bottom: 0.5em;
    }

    p {
      margin-top: 0.5em;
      line-height: 1.5;
    }

    li {
      line-height: 1.5;
    }

    li.__0 {
      padding-left: 0;
    }

    li.__1 {
      padding-left: 0;
    }

    li.__2 {
      padding-left: 0;
    }

    li.__3 {
      padding-left: 20px;
    }

    li.__4 {
      padding-left: 40px;
    }

    pre {
      display: block;
      font-family: monospace;
      white-space: pre;
      margin: 1em 2px;
      padding: 15px;
      box-shadow: 0 0 2px #555;
      overflow-x: auto;
      background-color: #f0f0f0;
    }

    code {
      font-family: monospace;
      background-color: #f0f0f0;
    }

    *:not(pre) > code {
      padding: 5px;
    }

    #content a {
      color: #090;
    }

    #content img {
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }

    @media only screen and (max-width: 700px) {
      .grid {
        grid-template-columns: 0 minmax(0, 1fr);
        padding: 0 0 0 40px;
      }

      #toggle {
        display: block;
        position: fixed;
        top: 10px;
        left: 10px;        
        width: 20px;
        height: 30px;
        background: repeating-linear-gradient(#ddd, #fff 10px);
      }

      #nav {
        display: none;
      }

      #content {
        border-left: none;
        padding: 0 20px 0 1px;
      }
    }

    .show_nav {
      grid-template-columns: 1fr 2fr;
    }

    .show_nav > #nav {
      display: block;
    }

    .show_nav > #content * {
      font-size: 30%;
      padding: 0;
      overflow: hidden;
    }
  </style>

</head>

<body>

  <div class="grid">

    <div id="toggle"></div>

    <ul id="nav">
      
      
      
      <li class="__1 ">
        <a href="/xyz/docs/">XYZ</a>
      </li>
      
      
      
      <li class="__1 ">
        <a href="/xyz/docs/getting-started/">Getting started</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="__2 active">
        <a href="/xyz/docs/getting-started/deploy/">Deployments</a>
      </li>
      
      
      
      <li class="__2 ">
        <a href="/xyz/docs/getting-started/environment-settings/">Environment Settings</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

    </ul>

    <div id="content">
      <h2 id="deploying-serverless-functions-to-vercel">Deploying serverless functions to Vercel <a class="header-anchor" href="#deploying-serverless-functions-to-vercel">¶</a></h2>
<p>The XYZ host was designed to be deployed as a Serverless Function. By keeping memory uptake to a minimum it is possible to deploy XYZ on <a href="https://vercel.com/pricing">Vercel's free Hobby plan</a>.</p>
<p>A command line interface must be installed in order to deploy to Vercel.</p>
<pre><code>npm i -g vercel
</code></pre>
<p>With the CLI installed and logged in to a valid Vercel account it is possible to deploy a zero config XYZ host by typing <code>vercel</code> in the project root. For successive deployments it is necessary to set a production flag in order to bring the latest deployment to production.</p>
<pre><code>vercel --prod --force
</code></pre>
<p>The <code>--force</code> option ensures that the build directories are overwritten. This may be required to force the workspace to change accross all process invocations.</p>
<h3 id="configuration-(vercel.json)">Configuration (vercel.json) <a class="header-anchor" href="#configuration-(vercel.json)">¶</a></h3>
<p>The project will be deployed and build according to the <a href="https://github.com/GEOLYTIX/xyz/blob/master/vercel.json">vercel.json</a> which is located in the project's root.</p>
<pre><code>{
  &quot;version&quot;: 2,
  &quot;regions&quot;: [
    &quot;lhr1&quot;
  ],
  &quot;build&quot;: {
    &quot;env&quot;: {
      &quot;NODE_ENV&quot;: &quot;production&quot;
    }
  },
  &quot;functions&quot;: {
    &quot;api/api.js&quot;: {
      &quot;includeFiles&quot;: &quot;public/**&quot;
    }
  },
  &quot;trailingSlash&quot;: false,
  &quot;headers&quot;: [{
    &quot;source&quot;: &quot;/(.*)&quot;,
    &quot;headers&quot;: [{
        &quot;key&quot;: &quot;Access-Control-Allow-Origin&quot;,
        &quot;value&quot;: &quot;*&quot;
      },
      {
        &quot;key&quot;: &quot;Cache-Control&quot;,
        &quot;value&quot;: &quot;no-cache&quot;
      },
      {
        &quot;key&quot;: &quot;Access-Control-Allow-Headers&quot;,
        &quot;value&quot;: &quot;Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With&quot;
      },
      {
        &quot;key&quot;: &quot;Content-Security-Policy&quot;,
        &quot;value&quot;: &quot;default-src 'self'; base-uri 'self'; object-src 'self'; connect-src 'self' *.maptiler.com *.mapbox.com; worker-src 'self' blob:; child-src 'self' blob:; frame-src 'self' www.google.com www.gstatic.com; form-action 'self'; style-src 'self' 'unsafe-inline' fonts.googleapis.com cdn.jsdelivr.net; font-src 'self' fonts.gstatic.com cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' api.mapbox.com www.google.com www.gstatic.com cdn.jsdelivr.net blob:; img-src 'self' geolytix.github.io api.ordnancesurvey.co.uk *.tile.openstreetmap.org api.mapbox.com res.cloudinary.com *.global.ssl.fastly.net raw.githubusercontent.com cdn.jsdelivr.net gitcdn.xyz data:&quot;
      }
    ]
  }],
  &quot;rewrites&quot;: [{
      &quot;source&quot;: &quot;/(workspaces|views|css|js|icons)/(.*)&quot;,
      &quot;destination&quot;: &quot;/$1/$2&quot;
    },
    {
      &quot;source&quot;: &quot;/api/query/:_template?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/location/:method?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/user/:method?/:key?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/workspace/:method?/:key?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/layer/:format?/:z?/:x?/:y?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/provider/:provider?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/api/(.*)&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/view/:_template?/:access?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/:access?&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    },
    {
      &quot;source&quot;: &quot;/&quot;,
      &quot;destination&quot;: &quot;/api/api.js&quot;
    }
  ]
}
</code></pre>
<p>Rewrites are required for url path parameter to be passed to the api process.</p>
<p>Headers allow the configuration of request header on all requests. These can be overwritten for individual requests prior to sending a response back to the client from inside the serverless function execution.</p>
<h2 id="content-security-policies-(csp)">Content Security Policies (CSP) <a class="header-anchor" href="#content-security-policies-(csp)">¶</a></h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">CSP</a> directives defined on the header define how the API may be accessed and which sources are valid for client applications. The default directives are:</p>
<p><em>default-src:</em> 'self'</p>
<p><em>base-uri:</em> 'self'</p>
<p><em>object-src:</em> 'self'</p>
<p><em>connect-src:</em> 'self' *.maptiler.com *.mapbox.com; worker-src 'self' blob:</p>
<p><em>child-src:</em> 'self' blob:</p>
<p><em>frame-src:</em> 'self' <a href="http://www.google.com">www.google.com</a> <a href="http://www.gstatic.com">www.gstatic.com</a></p>
<p><em>form-action:</em> 'self'</p>
<p><em>style-src:</em> 'self' 'unsafe-inline' <a href="http://fonts.googleapis.com">fonts.googleapis.com</a> <a href="http://cdn.jsdelivr.net">cdn.jsdelivr.net</a></p>
<p><em>font-src:</em> 'self' <a href="http://fonts.gstatic.com">fonts.gstatic.com</a> <a href="http://cdn.jsdelivr.net">cdn.jsdelivr.net</a></p>
<p><em>script-src:</em> 'self' 'unsafe-inline' <a href="http://api.mapbox.com">api.mapbox.com</a> <a href="http://www.google.com">www.google.com</a> <a href="http://www.gstatic.com">www.gstatic.com</a> <a href="http://cdn.jsdelivr.net">cdn.jsdelivr.net</a> blob:</p>
<p><em>img-src:</em> 'self' <a href="http://geolytix.github.io">geolytix.github.io</a> <a href="http://api.ordnancesurvey.co.uk">api.ordnancesurvey.co.uk</a> *.tile.openstreetmap.org <a href="http://api.mapbox.com">api.mapbox.com</a> <a href="http://res.cloudinary.com">res.cloudinary.com</a> *.global.ssl.fastly.net <a href="http://raw.githubusercontent.com">raw.githubusercontent.com</a> <a href="http://cdn.jsdelivr.net">cdn.jsdelivr.net</a> gitcdn.xyz data:</p>
<p>Environment settings for Now deployments may be added as an env block to the vercel.json.</p>

    </div>

  </div>

</body>

<script>
    const toggle = document.getElementById('toggle');

    toggle.onclick = e => { e.target.parentElement.classList.toggle('show_nav'); };
</script>

</html>