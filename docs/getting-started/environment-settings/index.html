<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="https://geolytix.github.io/xyz/public/icons/favicon.ico">
  <title>Environment Settings</title>
  <style>

    body {
      margin: 0;
      padding: 0;
    }

    .header-anchor {
      font-size: 80%;
    }

    .grid {
      font-family: system-ui;
      display:grid;
      grid-template-columns: 200px 5fr;
      max-width: 1100px;
      margin: auto;
      padding: 0 30px;
    }

    #toggle {
        display: none;
    }

    #toggle:hover {
      cursor: pointer;
    }

    #nav {
      grid-column: 1;
      padding-inline-start: 0px;
      list-style-type: none;
      padding-right: 20px;
      margin: 3px 0;
      position: fixed;
    }

    #nav > *:first-child {
      line-height: 1;
      font-size: 30px;
      font-weight: bold;
    }

    #content {
      grid-column: 2;
      padding-left: 20px;
      border-left: 1px solid #ddd;
      margin: 10px 0;
      overflow: hidden;
      padding-bottom: 100%;
    }

    #content > *:first-child {
      margin: 0;
    }

    .active {
      font-weight: bold;
    }

    a {
      text-decoration: none;
      white-space: nowrap;
      color: #333;
    }

    h1, h2, h3 {
      margin-bottom: 0.5em;
    }

    p {
      margin-top: 0.5em;
      line-height: 1.5;
    }

    li {
      line-height: 1.5;
    }

    li.__0 {
      padding-left: 0;
    }

    li.__1 {
      padding-left: 0;
    }

    li.__2 {
      padding-left: 0;
    }

    li.__3 {
      padding-left: 20px;
    }

    li.__4 {
      padding-left: 40px;
    }

    pre {
      display: block;
      font-family: monospace;
      white-space: pre;
      margin: 1em 2px;
      padding: 15px;
      box-shadow: 0 0 2px #555;
      overflow-x: auto;
      background-color: #f0f0f0;
    }

    code {
      font-family: monospace;
      background-color: #f0f0f0;
    }

    *:not(pre) > code {
      padding: 5px;
    }

    #content a {
      color: #090;
    }

    #content img {
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }

    @media only screen and (max-width: 700px) {
      .grid {
        grid-template-columns: 0 1fr;
        padding: 0 0 0 40px;
      }

      #toggle {
        display: block;
        position: fixed;
        top: 10px;
        left: 10px;        
        width: 20px;
        height: 30px;
        background: repeating-linear-gradient(#ddd, #fff 10px);
      }

      #nav {
        display: none;
      }

      #content {
        border-left: none;
        padding: 0 20px 0 1px;
        overflow: hidden;
      }
    }

    .show_nav {
      grid-template-columns: 1fr 2fr;
    }

    .show_nav > #nav {
      display: block;
    }

    .show_nav > #content * {
      font-size: 30%;
      padding: 0;
      overflow: hidden;
    }
  </style>

</head>

<body>

  <div class="grid">

    <div id="toggle"></div>

    <ul id="nav">
      
      
      
      <li class="__1 ">
        <a href="/xyz/docs/">XYZ</a>
      </li>
      
      
      
      <li class="__1 ">
        <a href="/xyz/docs/getting-started/">Getting started</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="__2 ">
        <a href="/xyz/docs/getting-started/deploy/">Deployments</a>
      </li>
      
      
      
      <li class="__2 active">
        <a href="/xyz/docs/getting-started/environment-settings/">Environment Settings</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

    </ul>

    <div id="content">
      <h1 id="environment-settings">Environment settings <a class="header-anchor" href="#environment-settings">¶</a></h1>
<p>The XYZ process can be configured by providing environment variables. The process environment contains sensistive information such as connection strings for the data source layer.</p>
<p>A default workspace with a single OSM tile layer will be avilable if the XYZ process is executed without any environment variables defined.</p>
<p><code>PORT: &quot;3000&quot;</code></p>
<p>Setting the PORT environment variable will override the port on which express is listening for requests.</p>
<p><code>TITLE: &quot;GEOLYTIX | XYZ&quot;</code></p>
<p>The title will be used as cookie-name for authentication cookies set on the response header and passed as <code>&lt;title&gt;</code> tag to the default application views.</p>
<p><code>DIR: &quot;/open&quot;</code></p>
<p>The path for the application root. This allows for hosting multiple deployments with different paths on the same domain. <strong>Rewrites in the vercel.json must be prefixed with the DIR value if set.</strong></p>
<h2 id="workspace">Workspace <a class="header-anchor" href="#workspace">¶</a></h2>
<p>The <a href="/xyz/docs/workspace/workspaces">workspace</a> is a configuration of templates, locales, and layers available to the XYZ host. The workspace is a JSON document which may be located locally, on Github, or in a CDN.</p>
<p><code>WORKSPACE: &quot;https://geolytix.github.io/xyz/public/workspaces/dev.json&quot;</code></p>
<p>Any http(s) url which resolves to a JSON document without the need for authentication is valid.</p>
<p><code>WORKSPACE: &quot;file:dev.json&quot;</code></p>
<p>The XYZ host will look in the local directory public/workspaces for a matching file with the <code>file:</code> prefix in WORKSPACE variable value.</p>
<p><code>WORKSPACE: &quot;github:api.github.com/repos/GEOLYTIX/xyz_ressources/contents/mapp/workspace.json&quot;</code></p>
<p>The <code>github:</code> prefix will request the workspace document through the provider module. Requests for content from private Github repositories require a personal access token which can be generated at <a href="https://github.com/settings/tokens">github.com/settings/tokens</a>. The token value must be provided as the <code>KEY_GITHUB</code> environment variable value.</p>
<p><code>WORKSPACE: &quot;cloudfront:dev.geolytix.io/mapp/workspace.json&quot;</code></p>
<p>The <code>cloudfront:</code> prefix will request the workspace document through the provider module. A private key for AWS cloudfront must be provided in the XYZ root. The name of the key file, excluding the .pem extension must be provided as the <code>KEY_CLOUDFRONT</code> environment variable value.</p>
<h2 id="postgis-database-connections">PostGIS Database Connections <a class="header-anchor" href="#postgis-database-connections">¶</a></h2>
<p>Connection strings must be provided for all data sources which are referenced in a workspace.</p>
<p><code>&quot;DBS_XYZ&quot;: &quot;postgres://username:password@pg.geolytix.net:5432/database&quot;</code></p>
<p>Keys beginning with DBS_ store PostGIS data source connections. The remainder of the <code>&quot;DBS_***&quot;</code> string is the key for the database connection. This key must be referenced as the dbs parameter for all queries to the data source layer.</p>
<p><code>STATEMENT_TIMEOUT: 10000</code></p>
<p>Each query which is passed via node-postgres to the data source layer will timeout after 10 seconds. It is possible to overwrite the default timeout by setting the <code>STATEMENT_TIMEOUT</code> key in the environment settings.</p>
<h2 id="api-keys">API Keys <a class="header-anchor" href="#api-keys">¶</a></h2>
<p>Keys for 3rd party service provider must be in the environment settings for the XYZ host to access and proxy these services. A request proxied through the XYZ domain layer will not expose the keys used to the client.</p>
<p><code>&quot;KEY_GOOGLE&quot;: &quot;key=***&quot;</code></p>
<p>A <a href="https://developers.google.com/maps/documentation/javascript/get-api-key">Google Maps API key</a> required for the Google Maps API.</p>
<p><code>&quot;KEY_MAPBOX&quot;: &quot;access_token=pk.***&quot;</code></p>
<p>A <a href="https://www.mapbox.com/help/how-access-tokens-work">Mapbox access token</a> required for base maps and services requested from the Mapbox API.</p>
<p><code>&quot;KEY_HERE&quot;: &quot;app_id=***&amp;app_code=***&quot;</code></p>
<p>A <a href="https://developer.here.com">HERE API</a> key required for base maps and services requested from the HERE Maps API.</p>
<p><code>&quot;KEY_OS&quot;: &quot;***&quot;</code></p>
<p>An Ordnance Survey API key. The key is required for access to services such as the <a href="https://www.ordnancesurvey.co.uk/business-government/tools-support/open-zoomstack-support">OS Zoomstack</a> mapping layers.</p>
<p><code>&quot;CLOUDINARY&quot;: &quot;api_key api_secret cloud_name folder&quot;</code></p>
<p>A <a href="https://cloudinary.com/">Cloudinary</a> key, secret and folder for images to be stored.</p>
<p><code>&quot;KEY_OPENCAGE&quot;: &quot;***&quot;</code></p>
<p>API key required to access the <a href="https://opencagedata.com/api">Opencage geocoding service</a>.</p>
<h2 id="logging">Logging <a class="header-anchor" href="#logging">¶</a></h2>
<p>If enabled logs can be written from the execution of a serverless function to a log drain.</p>
<p><code>LOGS: &quot;true&quot;</code></p>
<p>Setting the <code>LOGS</code> environment variable to a <em>truthy</em> value will enable logging from the process execution.</p>
<p><code>KEY_LOGFLARE: &quot;***&quot;</code></p>
<p>Providing a Logflare ingest API key allows for logs to be sent to the Logflare API.</p>
<h2 id="access">Access <a class="header-anchor" href="#access">¶</a></h2>
<p>The access environment variable defines whether access to the XYZ API is restricted.</p>
<p><code>PRIVATE: &quot;postgres://username:password@pg.geolytix.net:5432/database|schema.table&quot;</code></p>
<p>Setting the <code>PRIVATE</code> access key requires authentication via token for all request sent to the XYZ API.</p>
<p><code>PUBLIC: &quot;postgres://username:password@pg.geolytix.net:5432/database|schema.table&quot;</code></p>
<p>By default access to the XYZ API is public. Providing an ACL connection string for the <code>PUBLIC</code> access variable allows the XYZ host to generate user token / cookies for elevated access to public endpoints.</p>
<p><code>SECRET: &quot;Look for a while at the china cat sunflower; Proud walking jingle in the midnight sun&quot;</code></p>
<p>The value of the <code>SECRET</code> environment variable is used to sign token for validation by the user authentication module.</p>
<p><code>FAILED_ATTEMPTS: &quot;3&quot;</code></p>
<p>Setting the <code>FAILED_ATTEMPTS</code> environment variable defines the number of failed login attempts after which a user account will be flagged as blocked.</p>
<p><code>APPROVAL_EXPIRY: &quot;5&quot;</code></p>
<p>Approved user accounts will expire after a number of days defined in <code>APPROVAL_EXPIRY</code> environment variable.</p>
<p><code>TRANSPORT: &quot;smtps://xyz%40geolytix.co.uk:password@smtp.gmail.com&quot;</code></p>
<p>User registration requires the XYZ host to send emails to registered user and administrator accounts. The value for the <code>TRANSPORT</code> environment must be a valid smtp(s) connection string.</p>
<p><code>ALIAS: &quot;geolytix.xyz&quot;</code></p>
<p>A domain <code>ALIAS</code> may be defined to overwrite the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host">host value from the request header</a> in mails send from the XYZ host. This is useful when domain rewrites are used.</p>
<p>The <a href="/xyz/docs/develop/security/authentication">XYZ Authentication Strategy</a> is described in the developer documentation.</p>

    </div>

  </div>

</body>

<script>
    const toggle = document.getElementById('toggle');

    toggle.onclick = e => { e.target.parentElement.classList.toggle('show_nav'); };
</script>

</html>